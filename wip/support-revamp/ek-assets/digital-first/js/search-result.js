var selCount=1,searchResult=function(){"use strict";var e={clsNameHiddenSearchContentType:"hidden-search-content-type",clsNameHiddenSearchContentTypeDisplay:"hidden-search-content-type-display",clsNameHiddenSearchProductNameId:"hidden-search-product-name-id",clsNameHiddenSearchProductNameIdDisplay:"hidden-search-product-name-id-display"},t={init:function(){var e=$.url();void 0!==e.param("q")?($(".search-box input").val(e.param("q")),t.storeUrlParams()):location.href+="?q=htc"},storeUrlParams:function(){var t=$.url();void 0!==t.param("content_type")&&$("."+e.clsNameHiddenSearchContentType).val(t.param("content_type")),void 0!==t.param("content_type_display")&&$("."+e.clsNameHiddenSearchContentTypeDisplay).val(t.param("content_type_display")),void 0!==t.param("product_name_id")&&$("."+e.clsNameHiddenSearchProductNameId).val(t.param("product_name_id")),void 0!==t.param("product_name_id_display")&&$("."+e.clsNameHiddenSearchProductNameIdDisplay).val(t.param("product_name_id_display"))},scrollToTop:function(){$("body").scrollTop(0)}};return t}(),resultList=function(){"use strict";var e,t,a={maxPagintionTotal:990,resultsPerRequest:10,clsNameGetHelp:"get-help",clsNameLoader:"loader-container",clsNameHasResult:"has-result",clsNameNoResult:"no-result",clsNameResultContainer:"search-result-info",clsNamePaginationContainer:"pagination-container",claNameAmountContaner:"amount",clsNameHiddenParamQ:"hidden-param-q",clsNameHiddenParamPagination:"hidden-param-pagination"},n={init:function(){},stripHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText},showGetHelp:function(){$("."+a.clsNameGetHelp).addClass("active")},hideGetHelp:function(){$("."+a.clsNameGetHelp).removeClass("active")},showLoader:function(){$("."+a.clsNameLoader).show()},hideLoader:function(){$("."+a.clsNameLoader).hide()},hasResultSetting:function(){$("."+a.clsNameHasResult).removeClass("hidden"),n.hideLoader()},noResultSetting:function(){$("."+a.clsNameNoResult).removeClass("hidden"),n.hideLoader()},hideAllWhenAjax:function(){$("."+a.clsNameHasResult).addClass("hidden"),$("."+a.clsNameNoResult).addClass("hidden"),n.showLoader(),n.clearResult()},clearResult:function(){$("."+a.clsNameResultContainer).html("")},setupAmountSpan:function(e){$("."+a.claNameAmountContaner).text(e)},setupPagination:function(e,i){e>a.maxPagintionTotal&&(e=a.maxPagintionTotal),$("."+a.clsNamePaginationContainer).pagination({dataSource:function(t){for(var a=[],n=1;n<=e;n++)a.push(n);t(a)},pageNumber:parseInt(i,10),pageRange:2,afterPageOnClick:function(e,a){t.val(a),n.pushParams()},afterPreviousOnClick:function(e,a){t.val(a),n.pushParams()},afterNextOnClick:function(e,a){t.val(a),n.pushParams()},callback:function(){n.updatePaginationSize(),searchResult.scrollToTop()}})},updatePaginationSize:function(){var e=$(".paginationjs");e.length>0&&($(window).width()<=commonSetting.mobileMaxReserlution()?e.addClass("paginationjs-small"):e.removeClass("paginationjs-small"))},loadResults:function(e){var t=searchData.setupAjaxCall(e,a.resultsPerRequest);searchData.cancleAjaxCall(),_ajaxCall=$.ajax({type:"GET",url:t.baseSearchURL,data:t.queryParam,dataType:"json",jsonp:!0,async:!0,cache:!1,beforeSend:function(){n.hideGetHelp(),n.hideAllWhenAjax()},success:function(t){var i=$("."+a.clsNameResultContainer);searchData.buildResultTemplate(t,i,function(t){t>0?(t>a.resultsPerRequest&&n.setupPagination(t,e),n.hasResultSetting(),n.setupAmountSpan(t)):n.noResultSetting()}),n.showGetHelp()},error:function(e){n.noResultSetting()}})},initObj:function(){e=$("."+a.clsNameHiddenParamQ),t=$("."+a.clsNameHiddenParamPagination)},updateHiddenInput:function(a){var i=$.url(),s=i.param("q"),l=i.param("pagination");n.initObj(),e.val(""),t.val(1),void 0!==s&&(e.val(s),void 0!==l&&t.val(l)),a()},pushParams:function(){var a=e.val(),n=t.val(),i="";void 0!==a&&a.length>0&&(i+="&q="+a),void 0!==n&&n.length>0&&(i+="&pagination="+n),i.length>0&&(i="?"+i.substring(1,i.length)),History.pushState({rand:Math.random(),q:a,pagination:n},document.title,i)},restorePageStatus:function(e){searchResult.init(),n.loadResults(t.val())}};return n}(),filter=function(){"use strict";var e={init:function(){$(".filter").find(".btn-filter").click(function(){$(".btn-filter").parents(".filter-amount-area").hasClass("open")?$(".btn-filter").parents(".filter-amount-area").removeClass("open"):$(".btn-filter").parents(".filter-amount-area").addClass("open")}),e.select()},setSelectListWidth:function(){var e=0;e=$(".filter-select").find(".td:nth-of-type(1)").width(),$(".btn-filter").width(e),$(".filter-list").width($(".filter").width()-$(".btn-filter").width()-26)},select:function(){var t=0,a="",n="";$(".filter-select").find("li").click(function(){if(!$(this).hasClass("chosen")&&!$(this).parent("ul").find("li.chosen").length){$(this).parent("ul").find("li").css({cursor:"default"}),$(this).addClass("chosen"),t=$(this).index()+1,a=$(this).parent("ul").attr("class"),n=$(this).html();var i={category:a,index:t,value:n};$(".filter-list").find("ul").append(tmpl("filter-chosen-list",i)),e.removeSelect(selCount),selCount++}})},removeSelect:function(e){$(".filter-list").find("li:nth-of-type("+e+")").click(function(){var e=0,t="";t=$(this).attr("class").split(" ")[0],e=$(this).attr("class").split(" ")[1],$(".btn-filter").parents(".filter-amount-area").hasClass("open")||$(".btn-filter").parents(".filter-amount-area").addClass("open"),$("."+t).find("li:nth-of-type("+e+")").removeClass("chosen"),$("."+t).find("li").css({cursor:"pointer"}),$(this).unbind("click"),$(this).remove(),selCount--})}};return e}();$(document).ready(function(){"use strict"}),$(window).resize(function(){"use strict";resultList.updatePaginationSize()}),function(e,t){"use strict";"file:"===document.location.protocol&&alert("The HTML5 History API (and thus History.js) do not work on files, please upload it to a server."),resultList.updateHiddenInput(function(){resultList.restorePageStatus(!0)}),History.Adapter.bind(e,"statechange",function(){History.getState();resultList.updateHiddenInput(function(){resultList.restorePageStatus(!1)})})}(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlYXJjaC1yZXN1bHQuanMiXSwibmFtZXMiOlsic2VsQ291bnQiLCJzZWFyY2hSZXN1bHQiLCJzZXR0aW5nIiwiY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlIiwiY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlRGlzcGxheSIsImNsc05hbWVIaWRkZW5TZWFyY2hQcm9kdWN0TmFtZUlkIiwiY2xzTmFtZUhpZGRlblNlYXJjaFByb2R1Y3ROYW1lSWREaXNwbGF5IiwiaW5pdCIsInVybCIsIiQiLCJwYXJhbSIsInZhbCIsInN0b3JlVXJsUGFyYW1zIiwibG9jYXRpb24iLCJocmVmIiwic2Nyb2xsVG9Ub3AiLCJzY3JvbGxUb3AiLCJyZXN1bHRMaXN0IiwiX2hpZGRlblEiLCJfaGlkZGVuUGFnaW5hdGlvbiIsIm1heFBhZ2ludGlvblRvdGFsIiwicmVzdWx0c1BlclJlcXVlc3QiLCJjbHNOYW1lR2V0SGVscCIsImNsc05hbWVMb2FkZXIiLCJjbHNOYW1lSGFzUmVzdWx0IiwiY2xzTmFtZU5vUmVzdWx0IiwiY2xzTmFtZVJlc3VsdENvbnRhaW5lciIsImNsc05hbWVQYWdpbmF0aW9uQ29udGFpbmVyIiwiY2xhTmFtZUFtb3VudENvbnRhbmVyIiwiY2xzTmFtZUhpZGRlblBhcmFtUSIsImNsc05hbWVIaWRkZW5QYXJhbVBhZ2luYXRpb24iLCJzdHJpcEhUTUwiLCJodG1sIiwidG1wIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidGV4dENvbnRlbnQiLCJpbm5lclRleHQiLCJzaG93R2V0SGVscCIsImFkZENsYXNzIiwiaGlkZUdldEhlbHAiLCJyZW1vdmVDbGFzcyIsInNob3dMb2FkZXIiLCJzaG93IiwiaGlkZUxvYWRlciIsImhpZGUiLCJoYXNSZXN1bHRTZXR0aW5nIiwibm9SZXN1bHRTZXR0aW5nIiwiaGlkZUFsbFdoZW5BamF4IiwiY2xlYXJSZXN1bHQiLCJzZXR1cEFtb3VudFNwYW4iLCJ0b3RhbENvdW50IiwidGV4dCIsInNldHVwUGFnaW5hdGlvbiIsInBhZ2VOdW1iZXIiLCJwYWdpbmF0aW9uIiwiZGF0YVNvdXJjZSIsImRvbmUiLCJyZXN1bHQiLCJpIiwicHVzaCIsInBhcnNlSW50IiwicGFnZVJhbmdlIiwiYWZ0ZXJQYWdlT25DbGljayIsImRhdGEiLCJwdXNoUGFyYW1zIiwiYWZ0ZXJQcmV2aW91c09uQ2xpY2siLCJhZnRlck5leHRPbkNsaWNrIiwiY2FsbGJhY2siLCJ1cGRhdGVQYWdpbmF0aW9uU2l6ZSIsInBhZ2luYXRpb25PYmoiLCJsZW5ndGgiLCJ3aW5kb3ciLCJ3aWR0aCIsImNvbW1vblNldHRpbmciLCJtb2JpbGVNYXhSZXNlcmx1dGlvbiIsImxvYWRSZXN1bHRzIiwiYWpheFNldHRpbmciLCJzZWFyY2hEYXRhIiwic2V0dXBBamF4Q2FsbCIsImNhbmNsZUFqYXhDYWxsIiwiX2FqYXhDYWxsIiwiYWpheCIsInR5cGUiLCJiYXNlU2VhcmNoVVJMIiwicXVlcnlQYXJhbSIsImRhdGFUeXBlIiwianNvbnAiLCJhc3luYyIsImNhY2hlIiwiYmVmb3JlU2VuZCIsInN1Y2Nlc3MiLCJyZXN1bHRMaXN0RGl2IiwiYnVpbGRSZXN1bHRUZW1wbGF0ZSIsImVycm9yIiwicmVzcG9uY2UiLCJpbml0T2JqIiwidXBkYXRlSGlkZGVuSW5wdXQiLCJwYXJhbVEiLCJwYXJhbVBhZ2luYXRpb24iLCJzZWxlY3RlZFEiLCJzZWxlY3RlZFBhZ2luYXRpb24iLCJ1cmxQYXRoIiwic3Vic3RyaW5nIiwiSGlzdG9yeSIsInB1c2hTdGF0ZSIsInJhbmQiLCJNYXRoIiwicmFuZG9tIiwicSIsInRpdGxlIiwicmVzdG9yZVBhZ2VTdGF0dXMiLCJpbml0aWFsIiwiZmlsdGVyIiwiZmluZCIsImNsaWNrIiwicGFyZW50cyIsImhhc0NsYXNzIiwic2VsZWN0Iiwic2V0U2VsZWN0TGlzdFdpZHRoIiwidGRXaWR0aCIsInNlbEluZGV4Iiwic2VsQ2F0ZWdvcnkiLCJzZWxWYWx1ZSIsInRoaXMiLCJwYXJlbnQiLCJjc3MiLCJjdXJzb3IiLCJpbmRleCIsImF0dHIiLCJjYXRlZ29yeSIsInZhbHVlIiwiYXBwZW5kIiwidG1wbCIsInJlbW92ZVNlbGVjdCIsInJlbW92ZUluZGV4IiwicmVtb3ZlQ2F0ZWdvcnkiLCJzcGxpdCIsInVuYmluZCIsInJlbW92ZSIsInJlYWR5IiwicmVzaXplIiwidW5kZWZpbmVkIiwicHJvdG9jb2wiLCJhbGVydCIsIkFkYXB0ZXIiLCJiaW5kIiwiZ2V0U3RhdGUiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLFVBQVcsRUFFWEMsYUFBZ0IsV0FDaEIsWUFFQSxJQUFJQyxJQUNBQywrQkFBa0MsNkJBQ2xDQyxzQ0FBeUMscUNBQ3pDQyxpQ0FBb0MsZ0NBQ3BDQyx3Q0FBMkMseUNBRzNDTCxHQUNBTSxLQUFNLFdBQ0YsR0FBSUMsR0FBTUMsRUFBRUQsVUFFa0IsS0FBbkJBLEVBQUlFLE1BQU0sTUFDakJELEVBQUUscUJBQXFCRSxJQUFJSCxFQUFJRSxNQUFNLE1BQ3JDVCxFQUFhVyxrQkFHYkMsU0FBU0MsTUFBUSxVQUd6QkYsZUFBZ0IsV0FDWixHQUFJSixHQUFNQyxFQUFFRCxVQUM2QixLQUE5QkEsRUFBSUUsTUFBTSxpQkFDakJELEVBQUUsSUFBTVAsRUFBUUMsZ0NBQWdDUSxJQUFJSCxFQUFJRSxNQUFNLHFCQUVqQixLQUF0Q0YsRUFBSUUsTUFBTSx5QkFDakJELEVBQUUsSUFBTVAsRUFBUUUsdUNBQXVDTyxJQUFJSCxFQUFJRSxNQUFNLDZCQUU3QixLQUFqQ0YsRUFBSUUsTUFBTSxvQkFDakJELEVBQUUsSUFBTVAsRUFBUUcsa0NBQWtDTSxJQUFJSCxFQUFJRSxNQUFNLHdCQUVoQixLQUF6Q0YsRUFBSUUsTUFBTSw0QkFDakJELEVBQUUsSUFBTVAsRUFBUUkseUNBQXlDSyxJQUFJSCxFQUFJRSxNQUFNLDZCQUkvRUssWUFBYSxXQUNUTixFQUFFLFFBQVFPLFVBQVUsSUFLNUIsT0FBT2YsTUFHUGdCLFdBQWMsV0FDZCxZQUVBLElBQUlDLEdBQ0FDLEVBQ0FqQixHQUNJa0Isa0JBQXFCLElBQ3JCQyxrQkFB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RUFBRW9ILE1BQU1LLEtBQUssU0FBU1EsTUFBTSxLQUFLLEdBQzFDakksRUFBRSxlQUFlNEcsUUFBUSx1QkFBdUJDLFNBQVMsU0FDMUQ3RyxFQUFFLGVBQWU0RyxRQUFRLHVCQUF1QjdFLFNBQVMsUUFFN0QvQixFQUFFLElBQU1nSSxHQUFnQnRCLEtBQUssa0JBQW9CcUIsRUFBYyxLQUFLOUYsWUFBWSxVQUNoRmpDLEVBQUUsSUFBTWdJLEdBQWdCdEIsS0FBSyxNQUFNWSxLQUFNQyxPQUFVLFlBQ25EdkgsRUFBRW9ILE1BQU1jLE9BQU8sU0FDZmxJLEVBQUVvSCxNQUFNZSxTQUNSNUksY0FJWixPQUFPa0gsS0FHWHpHLEdBQUV5QixVQUFVMkcsTUFBTSxXQUNkLGVBSUpwSSxFQUFFZ0UsUUFBUXFFLE9BQU8sV0FDYixZQUNBN0gsWUFBV3FELHlCQUdmLFNBQVVHLEVBQVFzRSxHQUNkLFlBRW1DLFdBQS9CN0csU0FBU3JCLFNBQVNtSSxVQUNsQkMsTUFBTSxtR0FHVmhJLFdBQVdpRixrQkFBa0IsV0FDekJqRixXQUFXK0YsbUJBQWtCLEtBR2pDUCxRQUFReUMsUUFBUUMsS0FBSzFFLEVBQVEsY0FBZSxXQUM1QmdDLFFBQVEyQyxVQUVwQm5JLFlBQVdpRixrQkFBa0IsV0FDekJqRixXQUFXK0YsbUJBQWtCLFFBSXRDdkMiLCJmaWxlIjoic2VhcmNoLXJlc3VsdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIHNlYXJjaERhdGEsIHRtcGwsIF9hamF4Q2FsbCwgY29tbW9uU2V0dGluZywgSGlzdG9yeSovXG52YXIgc2VsQ291bnQgPSAxO1xuXG52YXIgc2VhcmNoUmVzdWx0ID0gKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzZXR0aW5nID0ge1xuICAgICAgICAnY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlJzogJ2hpZGRlbi1zZWFyY2gtY29udGVudC10eXBlJyxcbiAgICAgICAgJ2Nsc05hbWVIaWRkZW5TZWFyY2hDb250ZW50VHlwZURpc3BsYXknOiAnaGlkZGVuLXNlYXJjaC1jb250ZW50LXR5cGUtZGlzcGxheScsXG4gICAgICAgICdjbHNOYW1lSGlkZGVuU2VhcmNoUHJvZHVjdE5hbWVJZCc6ICdoaWRkZW4tc2VhcmNoLXByb2R1Y3QtbmFtZS1pZCcsXG4gICAgICAgICdjbHNOYW1lSGlkZGVuU2VhcmNoUHJvZHVjdE5hbWVJZERpc3BsYXknOiAnaGlkZGVuLXNlYXJjaC1wcm9kdWN0LW5hbWUtaWQtZGlzcGxheSdcbiAgICB9O1xuXG4gICAgdmFyIHNlYXJjaFJlc3VsdCA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gJC51cmwoKSxcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwucGFyYW0oJ3EnKSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAkKCcuc2VhcmNoLWJveCBpbnB1dCcpLnZhbCh1cmwucGFyYW0oJ3EnKSk7XG4gICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0LnN0b3JlVXJsUGFyYW1zKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vcmVzdWx0TGlzdC5oaWRlTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiArPSAnP3E9aHRjJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3RvcmVVcmxQYXJhbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHVybCA9ICQudXJsKCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybC5wYXJhbSgnY29udGVudF90eXBlJykgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVIaWRkZW5TZWFyY2hDb250ZW50VHlwZSkudmFsKHVybC5wYXJhbSgnY29udGVudF90eXBlJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwucGFyYW0oJ2NvbnRlbnRfdHlwZV9kaXNwbGF5JykgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVIaWRkZW5TZWFyY2hDb250ZW50VHlwZURpc3BsYXkpLnZhbCh1cmwucGFyYW0oJ2NvbnRlbnRfdHlwZV9kaXNwbGF5JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwucGFyYW0oJ3Byb2R1Y3RfbmFtZV9pZCcpICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICQoJy4nICsgc2V0dGluZy5jbHNOYW1lSGlkZGVuU2VhcmNoUHJvZHVjdE5hbWVJZCkudmFsKHVybC5wYXJhbSgncHJvZHVjdF9uYW1lX2lkJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwucGFyYW0oJ3Byb2R1Y3RfbmFtZV9pZF9kaXNwbGF5JykgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVIaWRkZW5TZWFyY2hQcm9kdWN0TmFtZUlkRGlzcGxheSkudmFsKHVybC5wYXJhbSgncHJvZHVjdF9uYW1lX2lkX2Rpc3BsYXknKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgc2Nyb2xsVG9Ub3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnYm9keScpLnNjcm9sbFRvcCgwKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIHJldHVybiBzZWFyY2hSZXN1bHQ7XG59KCkpO1xuXG52YXIgcmVzdWx0TGlzdCA9IChmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgX2hpZGRlblEsXG4gICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uLFxuICAgICAgICBzZXR0aW5nID0ge1xuICAgICAgICAgICAgJ21heFBhZ2ludGlvblRvdGFsJzogOTkwLCAvL0dTQSBsaW1pdGF0aW9uOiB0aGUgdmFsdWUgb2YgdGhlIG51bSBwYXJhbWV0ZXIgY2Fubm90IGV4Y2VlZCAxLDAwMFxuICAgICAgICAgICAgJ3Jlc3VsdHNQZXJSZXF1ZXN0JzogMTAsXG4gICAgICAgICAgICAnY2xzTmFtZUdldEhlbHAnOiAnZ2V0LWhlbHAnLFxuICAgICAgICAgICAgJ2Nsc05hbWVMb2FkZXInOiAnbG9hZGVyLWNvbnRhaW5lcicsXG4gICAgICAgICAgICAnY2xzTmFtZUhhc1Jlc3VsdCc6ICdoYXMtcmVzdWx0JyxcbiAgICAgICAgICAgICdjbHNOYW1lTm9SZXN1bHQnOiAnbm8tcmVzdWx0JyxcbiAgICAgICAgICAgICdjbHNOYW1lUmVzdWx0Q29udGFpbmVyJzogJ3NlYXJjaC1yZXN1bHQtaW5mbycsXG4gICAgICAgICAgICAnY2xzTmFtZVBhZ2luYXRpb25Db250YWluZXInOiAncGFnaW5hdGlvbi1jb250YWluZXInLFxuICAgICAgICAgICAgJ2NsYU5hbWVBbW91bnRDb250YW5lcic6ICdhbW91bnQnLFxuICAgICAgICAgICAgJ2Nsc05hbWVIaWRkZW5QYXJhbVEnOiAnaGlkZGVuLXBhcmFtLXEnLFxuICAgICAgICAgICAgJ2Nsc05hbWVIaWRkZW5QYXJhbVBhZ2luYXRpb24nOiAnaGlkZGVuLXBhcmFtLXBhZ2luYXRpb24nXG4gICAgICAgIH07XG5cbiAgICB2YXIgcmVzdWx0TGlzdCA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzdHJpcEhUTUw6IGZ1bmN0aW9uKGh0bWwpIHtcbiAgICAgICAgICAgIHZhciB0bXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgdG1wLmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICByZXR1cm4gdG1wLnRleHRDb250ZW50IHx8IHRtcC5pbm5lclRleHQ7XG4gICAgICAgIH0sXG4gICAgICAgIHNob3dHZXRIZWxwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy4nICsgc2V0dGluZy5jbHNOYW1lR2V0SGVscCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB9LFxuICAgICAgICBoaWRlR2V0SGVscDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUdldEhlbHApLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd0xvYWRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUxvYWRlcikuc2hvdygpO1xuICAgICAgICB9LFxuICAgICAgICBoaWRlTG9hZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy4nICsgc2V0dGluZy5jbHNOYW1lTG9hZGVyKS5oaWRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGhhc1Jlc3VsdFNldHRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVIYXNSZXN1bHQpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIHJlc3VsdExpc3QuaGlkZUxvYWRlcigpO1xuICAgICAgICB9LFxuICAgICAgICBub1Jlc3VsdFNldHRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVOb1Jlc3VsdCkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgcmVzdWx0TGlzdC5oaWRlTG9hZGVyKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGVBbGxXaGVuQWpheDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUhhc1Jlc3VsdCkuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVOb1Jlc3VsdCkuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgcmVzdWx0TGlzdC5zaG93TG9hZGVyKCk7XG4gICAgICAgICAgICByZXN1bHRMaXN0LmNsZWFyUmVzdWx0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGNsZWFyUmVzdWx0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy4nICsgc2V0dGluZy5jbHNOYW1lUmVzdWx0Q29udGFpbmVyKS5odG1sKCcnKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0dXBBbW91bnRTcGFuOiBmdW5jdGlvbih0b3RhbENvdW50KSB7XG4gICAgICAgICAgICAkKCcuJyArIHNldHRpbmcuY2xhTmFtZUFtb3VudENvbnRhbmVyKS50ZXh0KHRvdGFsQ291bnQpO1xuICAgICAgICB9LFxuICAgICAgICBzZXR1cFBhZ2luYXRpb246IGZ1bmN0aW9uKHRvdGFsQ291bnQsIHBhZ2VOdW1iZXIpIHtcbiAgICAgICAgICAgIGlmICh0b3RhbENvdW50ID4gc2V0dGluZy5tYXhQYWdpbnRpb25Ub3RhbCkge1xuICAgICAgICAgICAgICAgIHRvdGFsQ291bnQgPSBzZXR0aW5nLm1heFBhZ2ludGlvblRvdGFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVQYWdpbmF0aW9uQ29udGFpbmVyKS5wYWdpbmF0aW9uKHtcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlOiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gdG90YWxDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkb25lKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYWdlTnVtYmVyOiBwYXJzZUludChwYWdlTnVtYmVyLCAxMCksXG4gICAgICAgICAgICAgICAgcGFnZVJhbmdlOiAyLFxuICAgICAgICAgICAgICAgIGFmdGVyUGFnZU9uQ2xpY2s6IGZ1bmN0aW9uKGRhdGEsIHBhZ2luYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgX2hpZGRlblBhZ2luYXRpb24udmFsKHBhZ2luYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0LnB1c2hQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFmdGVyUHJldmlvdXNPbkNsaWNrOiBmdW5jdGlvbihkYXRhLCBwYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uLnZhbChwYWdpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5wdXNoUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhZnRlck5leHRPbkNsaWNrOiBmdW5jdGlvbihkYXRhLCBwYWdpbmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uLnZhbChwYWdpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5wdXNoUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QudXBkYXRlUGFnaW5hdGlvblNpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0LnNjcm9sbFRvVG9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZVBhZ2luYXRpb25TaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBwYWdpbmF0aW9uT2JqID0gJCgnLnBhZ2luYXRpb25qcycpO1xuICAgICAgICAgICAgaWYgKHBhZ2luYXRpb25PYmoubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSBjb21tb25TZXR0aW5nLm1vYmlsZU1heFJlc2VybHV0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbk9iai5hZGRDbGFzcygncGFnaW5hdGlvbmpzLXNtYWxsJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbk9iai5yZW1vdmVDbGFzcygncGFnaW5hdGlvbmpzLXNtYWxsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBzZWFyY2ggYW5kIGdldCBqc29uIGRhdGFcbiAgICAgICAgbG9hZFJlc3VsdHM6IGZ1bmN0aW9uKHBhZ2VOdW1iZXIpIHtcblxuICAgICAgICAgICAgdmFyIGFqYXhTZXR0aW5nID0gc2VhcmNoRGF0YS5zZXR1cEFqYXhDYWxsKHBhZ2VOdW1iZXIsIHNldHRpbmcucmVzdWx0c1BlclJlcXVlc3QpO1xuICAgICAgICAgICAgLy9pZiBhamF4IGlzIGNhbGxpbmcsIGNhbmNsZSBpdCBmaXJzdDtcbiAgICAgICAgICAgIHNlYXJjaERhdGEuY2FuY2xlQWpheENhbGwoKTtcblxuICAgICAgICAgICAgLy9DYWxsIGFqYXhcbiAgICAgICAgICAgIF9hamF4Q2FsbCA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBhamF4U2V0dGluZy5iYXNlU2VhcmNoVVJMLFxuICAgICAgICAgICAgICAgIGRhdGE6IGFqYXhTZXR0aW5nLnF1ZXJ5UGFyYW0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBqc29ucDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuaGlkZUdldEhlbHAoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5oaWRlQWxsV2hlbkFqYXgoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHJlc3BvbmNlIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRMaXN0RGl2ID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVSZXN1bHRDb250YWluZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuYnVpbGRSZXN1bHRUZW1wbGF0ZShkYXRhLCByZXN1bHRMaXN0RGl2LCBmdW5jdGlvbih0b3RhbENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxDb3VudCA+IHNldHRpbmcucmVzdWx0c1BlclJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3RvdGFsQ291bnQgPSAnICsgdG90YWxDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdwYWdlTnVtYmVyID0gJyArIHBhZ2VOdW1iZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0LnNldHVwUGFnaW5hdGlvbih0b3RhbENvdW50LCBwYWdlTnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5oYXNSZXN1bHRTZXR0aW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5zZXR1cEFtb3VudFNwYW4odG90YWxDb3VudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3Qubm9SZXN1bHRTZXR0aW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0LnNob3dHZXRIZWxwKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3Qubm9SZXN1bHRTZXR0aW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vc3RhdGVVUGRhdGVcbiAgICAgICAgaW5pdE9iajogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfaGlkZGVuUSA9ICQoJy4nICsgc2V0dGluZy5jbHNOYW1lSGlkZGVuUGFyYW1RKTtcbiAgICAgICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVIaWRkZW5QYXJhbVBhZ2luYXRpb24pO1xuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVIaWRkZW5JbnB1dDogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSAkLnVybCgpLFxuICAgICAgICAgICAgICAgIHBhcmFtUSA9IHVybC5wYXJhbSgncScpLFxuICAgICAgICAgICAgICAgIHBhcmFtUGFnaW5hdGlvbiA9IHVybC5wYXJhbSgncGFnaW5hdGlvbicpO1xuXG4gICAgICAgICAgICByZXN1bHRMaXN0LmluaXRPYmooKTtcblxuICAgICAgICAgICAgX2hpZGRlblEudmFsKCcnKTtcbiAgICAgICAgICAgIC8vZGVmYXVsdCBwYWdpbmF0aW9uIHZhbHVlID0gMTtcbiAgICAgICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uLnZhbCgxKTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbVEgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgX2hpZGRlblEudmFsKHBhcmFtUSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbVBhZ2luYXRpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5QYWdpbmF0aW9uLnZhbChwYXJhbVBhZ2luYXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdXBkYXRlIGhpZGRlbiBpcHV0cyBhbmQgdGhlblxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSxcbiAgICAgICAgcHVzaFBhcmFtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRRID0gX2hpZGRlblEudmFsKCksXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRQYWdpbmF0aW9uID0gX2hpZGRlblBhZ2luYXRpb24udmFsKCksXG4gICAgICAgICAgICAgICAgdXJsUGF0aCA9ICcnO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RlZFEgIT09ICd1bmRlZmluZWQnICYmIHNlbGVjdGVkUS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdXJsUGF0aCArPSAnJnE9JyArIHNlbGVjdGVkUTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0ZWRQYWdpbmF0aW9uICE9PSAndW5kZWZpbmVkJyAmJiBzZWxlY3RlZFBhZ2luYXRpb24ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHVybFBhdGggKz0gJyZwYWdpbmF0aW9uPScgKyBzZWxlY3RlZFBhZ2luYXRpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXRoLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB1cmxQYXRoID0gJz8nICsgdXJsUGF0aC5zdWJzdHJpbmcoMSwgdXJsUGF0aC5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZSh7IHJhbmQ6IE1hdGgucmFuZG9tKCksIHE6IHNlbGVjdGVkUSwgcGFnaW5hdGlvbjogc2VsZWN0ZWRQYWdpbmF0aW9uIH0sIGRvY3VtZW50LnRpdGxlLCB1cmxQYXRoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzdG9yZVBhZ2VTdGF0dXM6IGZ1bmN0aW9uKGluaXRpYWwpIHtcbiAgICAgICAgICAgIHNlYXJjaFJlc3VsdC5pbml0KCk7XG4gICAgICAgICAgICByZXN1bHRMaXN0LmxvYWRSZXN1bHRzKF9oaWRkZW5QYWdpbmF0aW9uLnZhbCgpKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gcmVzdWx0TGlzdDtcbn0oKSk7XG5cbnZhciBmaWx0ZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBmaWx0ZXIgPSB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLmZpbHRlcicpLmZpbmQoJy5idG4tZmlsdGVyJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJy5idG4tZmlsdGVyJykucGFyZW50cygnLmZpbHRlci1hbW91bnQtYXJlYScpLmhhc0NsYXNzKCdvcGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmJ0bi1maWx0ZXInKS5wYXJlbnRzKCcuZmlsdGVyLWFtb3VudC1hcmVhJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCcuYnRuLWZpbHRlcicpLnBhcmVudHMoJy5maWx0ZXItYW1vdW50LWFyZWEnKS5hZGRDbGFzcygnb3BlbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZmlsdGVyLnNlbGVjdCgpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRTZWxlY3RMaXN0V2lkdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRkV2lkdGggPSAwO1xuICAgICAgICAgICAgdGRXaWR0aCA9ICQoJy5maWx0ZXItc2VsZWN0JykuZmluZCgnLnRkOm50aC1vZi10eXBlKDEpJykud2lkdGgoKTtcbiAgICAgICAgICAgICQoJy5idG4tZmlsdGVyJykud2lkdGgodGRXaWR0aCk7XG4gICAgICAgICAgICAkKCcuZmlsdGVyLWxpc3QnKS53aWR0aCgkKCcuZmlsdGVyJykud2lkdGgoKSAtICQoJy5idG4tZmlsdGVyJykud2lkdGgoKSAtIDI2KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzZWxJbmRleCA9IDAsXG4gICAgICAgICAgICAgICAgc2VsQ2F0ZWdvcnkgPSAnJyxcbiAgICAgICAgICAgICAgICBzZWxWYWx1ZSA9ICcnO1xuICAgICAgICAgICAgJCgnLmZpbHRlci1zZWxlY3QnKS5maW5kKCdsaScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnY2hvc2VuJykgJiYgISQodGhpcykucGFyZW50KCd1bCcpLmZpbmQoJ2xpLmNob3NlbicpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgndWwnKS5maW5kKCdsaScpLmNzcyh7ICdjdXJzb3InOiAnZGVmYXVsdCcgfSk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2Nob3NlbicpO1xuICAgICAgICAgICAgICAgICAgICBzZWxJbmRleCA9ICQodGhpcykuaW5kZXgoKSArIDE7XG4gICAgICAgICAgICAgICAgICAgIHNlbENhdGVnb3J5ID0gJCh0aGlzKS5wYXJlbnQoJ3VsJykuYXR0cignY2xhc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsVmFsdWUgPSAkKHRoaXMpLmh0bWwoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiBzZWxDYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kZXhcIjogc2VsSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IHNlbFZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICQoJy5maWx0ZXItbGlzdCcpLmZpbmQoJ3VsJykuYXBwZW5kKHRtcGwoXCJmaWx0ZXItY2hvc2VuLWxpc3RcIiwgZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIucmVtb3ZlU2VsZWN0KHNlbENvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2VsQ291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlU2VsZWN0OiBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAgICAgJCgnLmZpbHRlci1saXN0JykuZmluZCgnbGk6bnRoLW9mLXR5cGUoJyArIGluZGV4ICsgJyknKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlSW5kZXggPSAwLFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVDYXRlZ29yeSA9ICcnO1xuICAgICAgICAgICAgICAgIHJlbW92ZUNhdGVnb3J5ID0gJCh0aGlzKS5hdHRyKCdjbGFzcycpLnNwbGl0KCcgJylbMF07XG4gICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXggPSAkKHRoaXMpLmF0dHIoJ2NsYXNzJykuc3BsaXQoJyAnKVsxXTtcbiAgICAgICAgICAgICAgICBpZiAoISQoJy5idG4tZmlsdGVyJykucGFyZW50cygnLmZpbHRlci1hbW91bnQtYXJlYScpLmhhc0NsYXNzKCdvcGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmJ0bi1maWx0ZXInKS5wYXJlbnRzKCcuZmlsdGVyLWFtb3VudC1hcmVhJykuYWRkQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJCgnLicgKyByZW1vdmVDYXRlZ29yeSkuZmluZCgnbGk6bnRoLW9mLXR5cGUoJyArIHJlbW92ZUluZGV4ICsgJyknKS5yZW1vdmVDbGFzcygnY2hvc2VuJyk7XG4gICAgICAgICAgICAgICAgJCgnLicgKyByZW1vdmVDYXRlZ29yeSkuZmluZCgnbGknKS5jc3MoeyAnY3Vyc29yJzogJ3BvaW50ZXInIH0pO1xuICAgICAgICAgICAgICAgICQodGhpcykudW5iaW5kKCdjbGljaycpO1xuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgc2VsQ291bnQtLTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gZmlsdGVyO1xufSgpKTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG59KTtcblxuJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmVzdWx0TGlzdC51cGRhdGVQYWdpbmF0aW9uU2l6ZSgpO1xufSk7XG5cbihmdW5jdGlvbih3aW5kb3csIHVuZGVmaW5lZCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvLyBDaGVjayBMb2NhdGlvblxuICAgIGlmIChkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2ZpbGU6Jykge1xuICAgICAgICBhbGVydCgnVGhlIEhUTUw1IEhpc3RvcnkgQVBJIChhbmQgdGh1cyBIaXN0b3J5LmpzKSBkbyBub3Qgd29yayBvbiBmaWxlcywgcGxlYXNlIHVwbG9hZCBpdCB0byBhIHNlcnZlci4nKTtcbiAgICB9XG5cbiAgICByZXN1bHRMaXN0LnVwZGF0ZUhpZGRlbklucHV0KGZ1bmN0aW9uKCkge1xuICAgICAgICByZXN1bHRMaXN0LnJlc3RvcmVQYWdlU3RhdHVzKHRydWUpO1xuICAgIH0pO1xuXG4gICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAnc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHsgLy8gTm90ZTogV2UgYXJlIHVzaW5nIHN0YXRlY2hhbmdlIGluc3RlYWQgb2YgcG9wc3RhdGVcbiAgICAgICAgdmFyIFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZSgpO1xuXG4gICAgICAgIHJlc3VsdExpc3QudXBkYXRlSGlkZGVuSW5wdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXN1bHRMaXN0LnJlc3RvcmVQYWdlU3RhdHVzKGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbn0pKHdpbmRvdyk7Il19
