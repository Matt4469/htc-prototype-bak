!function(e){"use strict";e.fn.delayKeyup=function(t,a){var n=0,s=e(this);return e(this).keyup(function(e){clearTimeout(n),n=setTimeout(function(){t(s,e)},a)}),e(this)},e.fn.scrollTo=function(t,a){return e(this).animate({scrollTop:e(this).scrollTop()-e(this).offset().top+e(t).offset().top-20},void 0===a?400:a),this}}(jQuery);var _ajaxCall,searchData=function(){"use strict";var e={resultsPerRequest:5,resultPagePath:"search-result.htm",minSearchWords:"3",clsNameAspDotNetForm:"support-form",clsNameForm:"search-box",clsNameInput:"input-query",clsNameButtonSubmit:"button-submit",clsNameSuggestionArea:"smart-search-result-container",clsNameSuggestionList:"search-result",clsNameCloseBtn:"close-resulte-container-btn",clsNameHiddenSearchContentType:"hidden-search-content-type",clsNameHiddenSearchContentTypeDisplay:"hidden-search-content-type-display",clsNameHiddenSearchProductNameId:"hidden-search-product-name-id",clsNameHiddenSearchProductNameIdDisplay:"hidden-search-product-name-id-display"},t=!1,a={init:function(){!t&&$(".search-box").length>0&&(a.disableDefaultFromSubmit(),a.detectInputKey(),a.setupSubmit(),a.setupShowAllResultLink(),a.setupCloseResultContainerButton(),a.setupOutOfSearchAreaClick(),t=!0)},disableDefaultFromSubmit:function(){$("."+e.clsNameAspDotNetForm).on("submit",function(e){e.preventDefault()})},setupOutOfSearchAreaClick:function(){$("body").on("click",function(e){$(e.target).hasClass("search-box")||$(e.target).hasClass("icon-search")||$(e.target).hasClass("input-query")||$(e.target).hasClass("smart-search-result-container")||$(e.target).hasClass("border-area")||$(e.target).hasClass("show-all-result")||$(e.target).hasClass("button-submit")||$(e.target).hasClass("search-result")||$(e.target).hasClass("search-result-data")||$(e.target).hasClass("search-data-img")||$(e.target).hasClass("search-data-info")||$(e.target).hasClass("search-data-title")||$(e.target).hasClass("search-data-desc")||a.hideSuggestionList()})},setupCloseResultContainerButton:function(){$("."+e.clsNameCloseBtn).bind("click",function(){a.hideSuggestionList()})},showSuggestionList:function(){$("."+e.clsNameSuggestionArea).addClass("show")},hideSuggestionList:function(){var t=$("."+e.clsNameSuggestionArea),a=t.find("."+e.clsNameSuggestionList);t.removeClass("show"),a.html("")},validateQuery:function(){var t=!1;return $("."+e.clsNameForm+" ."+e.clsNameInput).val().trim().length>0&&(t=!0),t},setupSubmit:function(){$("."+e.clsNameForm+" ."+e.clsNameButtonSubmit).on("click",function(){a.goToResultPage()})},setupShowAllResultLink:function(){$("."+e.clsNameSuggestionArea+" ."+e.clsNameButtonSubmit).on("click",function(){a.goToResultPage()})},detectInputKey:function(){var t=$("."+e.clsNameForm+" ."+e.clsNameInput);t.off("click").on("click",function(){$(this).select()}),t.delayKeyup(function(t,n){n=n||window.event;var s=n.which||n.keyCode,i=String.fromCharCode(s);n.preventDefault();var r=!1;if(commonSetting.isMobile()?r=!0:(/[a-z0-9]/i.test(i)||8===s||32===s)&&(r=!0),r){var o=t.val(),l=e.minSearchWords;a.hideSuggestionList(),o.length>=l?$("."+e.clsNameForm).hasClass("show-suggestion-list")&&a.getJsonData():a.cancleAjaxCall()}a.setupDownAndUpKeyEvent(s)})},setupDownAndUpKeyEvent:function(t){var n,s,i,r=!1,o=$("."+e.clsNameSuggestionArea),l=o.find("."+e.clsNameSuggestionList),c=l.find("li").length,u=l.find("li > a.active").length;$("."+e.clsNameForm+" ."+e.clsNameInput);c>0&&(r=!0),13===t&&(r&&u>0?location.href=l.find("li > a.active").attr("href"):a.goToResultPage()),40===t&&r&&(n=0,0===u?s=0:(n=l.find("li > a.active").parent().index(),(s=n+1)===c&&(s=0)),l.find("li > a").removeClass("active"),l.find("li").eq(s).children("a").addClass("active"),l.scrollTo(l.find("li > a.active"))),38===t&&r&&(n=0,0===l.find("li > a.active").length?i=0:(n=l.find("li > a.active").parent().index(),(i=n-1)<0&&(i=c-1)),l.find("li > a").removeClass("active"),l.find("li").eq(i).children("a").addClass("active"),l.scrollTo(l.find("li > a.active")))},setupUrlParams:function(){var t=$("."+e.clsNameHiddenSearchContentType),a=$("."+e.clsNameHiddenSearchContentTypeDisplay),n=$("."+e.clsNameHiddenSearchProductNameId),s=$("."+e.clsNameHiddenSearchProductNameIdDisplay),i="",r="",o="",l="";return t.length>0&&a.length>0&&""!==t.val()&&""!==a.val()&&(i="&content_type="+encodeURIComponent(t.val()),r="&content_type_display="+encodeURIComponent(a.val())),n.length>0&&s.length>0&&""!==n.val()&&""!==s.val()&&(o="&product_name_id="+encodeURIComponent(n.val()),l="&product_name_id_display="+encodeURIComponent(s.val())),i+r+o+l},goToResultPage:function(){if(a.validateQuery()){var t,n=$("."+e.clsNameForm+" ."+e.clsNameInput);t=commonSetting.isPrototypeHost()?e.resultPagePath:"/"+$("body").data("site")+"/support/search.aspx",location.href=t+"?q="+encodeURIComponent(n.val().trim())+a.setupUrlParams()}},stripHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText},findMeta:function(e,t){var a=$(e),n="";return a.each(function(e,a){if(a.N===t)return void(n=a.V)}),n},cancleAjaxCall:function(){void 0!==_ajaxCall&&_ajaxCall.abort()},setupAjaxCall:function(t,n){var s,i,r=$("body").data("site"),o=0,l="support-"+r,c=e.resultsPerRequest,u=$.url(),d=(u.param("p_name"),$("."+e.clsNameForm+" ."+e.clsNameInput)),m=d.val(),h="",p=$("."+e.clsNameHiddenSearchContentType),f=$("."+e.clsNameHiddenSearchProductNameId);if(a.validateQuery()){void 0!==t&&(o=(t-1)*c),void 0!==n&&(c=n),"www.htc.com"===u.attr("host")?(s="//ws.htc.com/htc-search-1.1/query/gsa/search","//www.htc.com"):(s="//dev2-ws.htc.com/htc-search-1.1/query/gsa/search","//dev-www.htc.com"),void 0!==p&&p.length>0&&""!==p.val()&&(h="content_type:"+p.val()),void 0!==f&&f.length>0&&""!==f.val()&&(""!==h&&(h+="."),h+="product_name_id:"+f.val()),i={output:"xml_no_dtd",ie:"utf8",oe:"utf8",getfields:"*",filter:0,site:"default_collection",client:l,q:m,start:o,num:c,as_dt:"i",requiredfields:h};return{baseSearchURL:s,queryParam:i}}return null},getJsonData:function(){var t=a.setupAjaxCall();a.cancleAjaxCall(),_ajaxCall=$.ajax({type:"GET",url:t.baseSearchURL,data:t.queryParam,dataType:"json",jsonp:!0,async:!0,cache:!1,success:function(t){var n=$("."+e.clsNameSuggestionArea),s=n.find("."+e.clsNameSuggestionList);a.buildResultTemplate(t,s,function(e){e>0&&a.showSuggestionList()})},error:function(e){}})},buildResultTemplate:function(e,t,n){var s,i=0,r="",o="",l="",c="";if(void 0!==e.GSP&&void 0!==e.GSP.RES)if(i=e.GSP.RES.M,void 0!==e.GSP.RES.R.length){s=e.GSP.RES.R;for(var u=0;u<s.length;u++){r=a.findMeta(s[u].MT,"content_type"),o=a.stripHTML(s[u].T),l=a.stripHTML(a.findMeta(s[u].MT,"description"))?a.stripHTML(a.findMeta(s[u].MT,"description")):a.stripHTML(s[u].S),c=s[u].U;var d={title:o,desc:l,url:c,icon:r};t.append(tmpl("search-result-tmp",d))}}else{var m=e.GSP.RES.R;r=a.findMeta(m.MT,"content_type"),o=a.stripHTML(m.T),l=a.findMeta(m.MT,"description")?a.findMeta(m.MT,"description"):a.stripHTML(m.S),c=m.U;var h={title:o,desc:l,url:c,icon:r};t.append(tmpl("search-result-tmp",h))}n(i)}};return a}();$(document).ready(function(){"use strict";searchData.init()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zbWFydC1zZWFyY2guanMiXSwibmFtZXMiOlsiJCIsImZuIiwiZGVsYXlLZXl1cCIsImNhbGxiYWNrIiwibXMiLCJ0aW1lciIsImVsIiwidGhpcyIsImtleXVwIiwiZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJzY3JvbGxUbyIsImVsZW0iLCJzcGVlZCIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJvZmZzZXQiLCJ0b3AiLCJ1bmRlZmluZWQiLCJqUXVlcnkiLCJfYWpheENhbGwiLCJzZWFyY2hEYXRhIiwic2V0dGluZyIsInJlc3VsdHNQZXJSZXF1ZXN0IiwicmVzdWx0UGFnZVBhdGgiLCJtaW5TZWFyY2hXb3JkcyIsImNsc05hbWVBc3BEb3ROZXRGb3JtIiwiY2xzTmFtZUZvcm0iLCJjbHNOYW1lSW5wdXQiLCJjbHNOYW1lQnV0dG9uU3VibWl0IiwiY2xzTmFtZVN1Z2dlc3Rpb25BcmVhIiwiY2xzTmFtZVN1Z2dlc3Rpb25MaXN0IiwiY2xzTmFtZUNsb3NlQnRuIiwiY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlIiwiY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlRGlzcGxheSIsImNsc05hbWVIaWRkZW5TZWFyY2hQcm9kdWN0TmFtZUlkIiwiY2xzTmFtZUhpZGRlblNlYXJjaFByb2R1Y3ROYW1lSWREaXNwbGF5IiwiaW5pdCIsImxlbmd0aCIsImRpc2FibGVEZWZhdWx0RnJvbVN1Ym1pdCIsImRldGVjdElucHV0S2V5Iiwic2V0dXBTdWJtaXQiLCJzZXR1cFNob3dBbGxSZXN1bHRMaW5rIiwic2V0dXBDbG9zZVJlc3VsdENvbnRhaW5lckJ1dHRvbiIsInNldHVwT3V0T2ZTZWFyY2hBcmVhQ2xpY2siLCJvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXQiLCJoYXNDbGFzcyIsImhpZGVTdWdnZXN0aW9uTGlzdCIsImJpbmQiLCJzaG93U3VnZ2VzdGlvbkxpc3QiLCJhZGRDbGFzcyIsInJlc3VsdENvbnRhaW5lciIsInJlc3VsdExpc3QiLCJmaW5kIiwicmVtb3ZlQ2xhc3MiLCJodG1sIiwidmFsaWRhdGVRdWVyeSIsInJlc3VsdCIsInZhbCIsInRyaW0iLCJnb1RvUmVzdWx0UGFnZSIsIiRpbnB1dCIsIm9mZiIsInNlbGVjdCIsIm9iaiIsImV2dCIsIndpbmRvdyIsImNoYXJDb2RlIiwid2hpY2giLCJrZXlDb2RlIiwiY2hhclN0ciIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImtleVBhc3MiLCJjb21tb25TZXR0aW5nIiwiaXNNb2JpbGUiLCJ0ZXN0IiwidGVybSIsIm1pblRlcm1zIiwiZ2V0SnNvbkRhdGEiLCJjYW5jbGVBamF4Q2FsbCIsInNldHVwRG93bkFuZFVwS2V5RXZlbnQiLCJjdXJyZW50SWR4IiwibmV4dElkeCIsInByZXZJZHgiLCJoYXNSZXN1bHQiLCJ0b3RhbEl0ZW1zIiwiYWN0aXZlQ291bnQiLCJsb2NhdGlvbiIsImhyZWYiLCJhdHRyIiwicGFyZW50IiwiaW5kZXgiLCJlcSIsImNoaWxkcmVuIiwic2V0dXBVcmxQYXJhbXMiLCJjb250ZW50VHlwZSIsImNvbnRlbnRUeXBlRGlzcGxheSIsInByb2R1Y3ROYW1lSWQiLCJwcm9kdWN0TmFtZUlkRGlzcGxheSIsImNvbnRlbnRUeXBlUGFyYW0iLCJjb250ZW50VHlwZURpc3BsYXlQYXJhbSIsInByb2R1Y3ROYW1lSWRQYXJhbSIsInByb2R1Y3ROYW1lSWREaXNwbGF5UGFyYW0iLCJlbmNvZGVVUklDb21wb25lbnQiLCJzZWFyY2hQYWdlUGF0aCIsImlzUHJvdG90eXBlSG9zdCIsImRhdGEiLCJzdHJpcEhUTUwiLCJ0bXAiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ0ZXh0Q29udGVudCIsImlubmVyVGV4dCIsImZpbmRNZXRhIiwibWV0YSIsIm1ldGFOYW1lIiwiJG1ldGEiLCJ2YWx1ZSIsImVhY2giLCJpZHgiLCJOIiwiViIsImFib3J0Iiwic2V0dXBBamF4Q2FsbCIsInBhZ2VOdW1iZXIiLCJyZXN1bHRzUGVyUGFnZSIsImJhc2VTZWFyY2hVUkwiLCJxdWVyeVBhcmFtIiwic2l0ZSIsInN0YXJ0TnVtYmVyIiwiY2xpZW50TmFtZSIsImNsaWVudCIsInVybCIsInBhcmFtIiwicSIsIm1ldGFGaWx0ZXIiLCJtZXRhQ29udGVudFR5cGUiLCJtZXRhUHJvZHVjdE5hbWVJZCIsIm91dHB1dCIsImllIiwib2UiLCJnZXRmaWVsZHMiLCJmaWx0ZXIiLCJzdGFydCIsIm51bSIsImFzX2R0IiwicmVxdWlyZWRmaWVsZHMiLCJhamF4U2V0dGluZyIsImFqYXgiLCJ0eXBlIiwiZGF0YVR5cGUiLCJqc29ucCIsImFzeW5jIiwiY2FjaGUiLCJzdWNjZXNzIiwicmVzdWx0TGlzdERpdiIsImJ1aWxkUmVzdWx0VGVtcGxhdGUiLCJ0b3RhbENvdW50IiwiZXJyb3IiLCJyZXNwb25jZSIsImFwcGVuZENvbnRhaW5lciIsImpBcnJheSIsInRtcEljb24iLCJ0bXBUaXRsZSIsInRtcERlc2NyaXAiLCJ0bXBVcmwiLCJHU1AiLCJSRVMiLCJNIiwiUiIsImkiLCJNVCIsIlQiLCJTIiwiVSIsInJlc3VsdERhdGEiLCJ0aXRsZSIsImRlc2MiLCJpY29uIiwiYXBwZW5kIiwidG1wbCIsIm9uRGF0YSIsInJlc3VsdE9uZURhdGEiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkNBRUMsU0FBU0EsR0FDTixZQUVBQSxHQUFFQyxHQUFHQyxXQUFhLFNBQVNDLEVBQVVDLEdBQ2pDLEdBQUlDLEdBQVEsRUFDUkMsRUFBS04sRUFBRU8sS0FRWCxPQU5BUCxHQUFFTyxNQUFNQyxNQUFNLFNBQVNDLEdBQ25CQyxhQUFhTCxHQUNiQSxFQUFRTSxXQUFXLFdBQ2ZSLEVBQVNHLEVBQUlHLElBQ2RMLEtBRUFKLEVBQUVPLE9BR2JQLEVBQUVDLEdBQUdXLFNBQVcsU0FBU0MsRUFBTUMsR0FLM0IsTUFIQWQsR0FBRU8sTUFBTVEsU0FDSkMsVUFBV2hCLEVBQUVPLE1BQU1TLFlBQWNoQixFQUFFTyxNQUFNVSxTQUFTQyxJQUFNbEIsRUFBRWEsR0FBTUksU0FBU0MsSUFBTSxRQUN0RUMsS0FBVkwsRUFBc0IsSUFBTUEsR0FDeEJQLE9BRWJhLE9BRUYsSUFBSUMsV0FFQUMsV0FBYyxXQUNkLFlBQ0EsSUFBSUMsSUFDSUMsa0JBQXFCLEVBQ3JCQyxlQUFrQixvQkFDbEJDLGVBQWtCLElBQ2xCQyxxQkFBd0IsZUFDeEJDLFlBQWUsYUFDZkMsYUFBZ0IsY0FDaEJDLG9CQUF1QixnQkFDdkJDLHNCQUF5QixnQ0FDekJDLHNCQUF5QixnQkFDekJDLGdCQUFtQiw4QkFDbkJDLCtCQUFrQyw2QkFDbENDLHNDQUF5QyxxQ0FDekNDLGlDQUFvQyxnQ0FDcENDLHdDQUEyQyx5Q0FFL0NDLEdBQU8sRUFFUGhCLEdBQ0FnQixLQUFNLFlBRUdBLEdBQVF0QyxFQUFFLGVBQWV1QyxPQUFTLElBQ25DakIsRUFBV2tCLDJCQUNYbEIsRUFBV21CLGlCQUNYbkIsRUFBV29CLGNBQ1hwQixFQUFXcUIseUJBQ1hyQixFQUFXc0Isa0NBQ1h0QixFQUFXdUIsNEJBQ1hQLEdBQU8sSUFHZkUseUJBQTBCLFdBQ3RCeEMsRUFBRSxJQUFNdUIsRUFBUUksc0JBQXNCbUIsR0FBRyxTQUFVLFNBQVNDLEdBQ3hEQSxFQUFNQyxvQkFHZEgsMEJBQTJCLFdBQ3ZCN0MsRUFBRSxRQUFROEMsR0FBRyxRQUFTLFNBQVNDLEdBRXZCL0MsRUFBRStDLEVBQU1FLFFBQVFDLFNBQVMsZUFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxnQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxnQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxrQ0FDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxnQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxvQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxrQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxrQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyx1QkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxvQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxxQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxzQkFDekJsRCxFQUFFK0MsRUFBTUUsUUFBUUMsU0FBUyxxQkFHekI1QixFQUFXNkIsd0JBSXZCUCxnQ0FBaUMsV0FDZDVDLEVBQUUsSUFBTXVCLEVBQVFVLGlCQUN0Qm1CLEtBQUssUUFBUyxXQUNuQjlCLEVBQVc2Qix3QkFHbkJFLG1CQUFvQixXQUNNckQsRUFBRSxJQUFNdUIsRUFBUVEsdUJBQ3RCdUIsU0FBUyxTQUU3QkgsbUJBQW9CLFdBQ2hCLEdBQUlJLEdBQWtCdkQsRUFBRSxJQUFNdUIsRUFBUVEsdUJBQ2xDeUIsRUFBYUQsRUFBZ0JFLEtBQUssSUFBTWxDLEVBQVFTLHNCQUNwRHVCLEdBQWdCRyxZQUFZLFFBQzVCRixFQUFXRyxLQUFLLEtBRXBCQyxjQUFlLFdBQ1gsR0FBSUMsSUFBUyxDQU1iLE9BTGE3RCxHQUFFLElBQU11QixFQUFRSyxZQUFjLEtBQU9MLEVBQVFNLGNBRS9DaUMsTUFBTUMsT0FBT3hCLE9BQVMsSUFDN0JzQixHQUFTLEdBRU5BLEdBRVhuQixZQUFhLFdBQ0sxQyxFQUFFLElBQU11QixFQUFRSyxZQUFjLEtBQU9MLEVBQVFPLHFCQUNuRGdCLEdBQUcsUUFBUyxXQUNoQnhCLEVBQVcwQyxvQkFHbkJyQix1QkFBd0IsV0FDTjNDLEVBQUUsSUFBTXVCLEVBQVFRLHNCQUF3QixLQUFPUixFQUFRTyxxQkFDN0RnQixHQUFHLFFBQVMsV0FDaEJ4QixFQUFXMEMsb0JBR25CdkIsZUFBZ0IsV0FDWixHQUFJd0IsR0FBU2pFLEVBQUUsSUFBTXVCLEVBQVFLLFlBQWMsS0FBT0wsRUFBUU0sYUFDMURvQyxHQUFPQyxJQUFJLFNBQVNwQixHQUFHLFFBQVMsV0FDNUI5QyxFQUFFTyxNQUFNNEQsV0FLWkYsRUFBTy9ELFdBQVcsU0FBU2tFLEVBQUtDLEdBQzVCQSxFQUFNQSxHQUFPQyxPQUFPdkIsS0FDcEIsSUFBSXdCLEdBQVdGLEVBQUlHLE9BQVNILEVBQUlJLFFBQzVCQyxFQUFVQyxPQUFPQyxhQUFhTCxFQUNsQ0YsR0FBSXJCLGdCQUNKLElBQUk2QixJQUFVLENBaUJkLElBYktDLGNBQWNDLFdBVWZGLEdBQVUsR0FUTixZQUFZRyxLQUFLTixJQUF5QixJQUFiSCxHQUErQixLQUFiQSxLQU0vQ00sR0FBVSxHQU1kQSxFQUFTLENBQ1QsR0FBSUksR0FBT2IsRUFBSU4sTUFFWG9CLEVBQVczRCxFQUFRRyxjQUV2QkosR0FBVzZCLHFCQUNQOEIsRUFBSzFDLFFBQVUyQyxFQUVYbEYsRUFBRSxJQUFNdUIsRUFBUUssYUFBYXNCLFNBQVMseUJBQ3RDNUIsRUFBVzZELGNBR2Y3RCxFQUFXOEQsaUJBS25COUQsRUFBVytELHVCQUF1QmQsTUFHMUNjLHVCQUF3QixTQUFTWixHQUM3QixHQUtJYSxHQUNBQyxFQUNBQyxFQVBBQyxHQUFZLEVBQ1psQyxFQUFrQnZELEVBQUUsSUFBTXVCLEVBQVFRLHVCQUNsQ3lCLEVBQWFELEVBQWdCRSxLQUFLLElBQU1sQyxFQUFRUyx1QkFDaEQwRCxFQUFhbEMsRUFBV0MsS0FBSyxNQUFNbEIsT0FDbkNvRCxFQUFjbkMsRUFBV0MsS0FBSyxpQkFBaUJsQixNQUl0Q3ZDLEdBQUUsSUFBTXVCLEVBQVFLLFlBQWMsS0FBT0wsRUFBUU0sYUFNdEQ2RCxHQUFhLElBQ2JELEdBQVksR0FNQSxLQUFaaEIsSUFHSWdCLEdBQWFFLEVBQWMsRUFLM0JDLFNBQVNDLEtBQU9yQyxFQUFXQyxLQUFLLGlCQUFpQnFDLEtBQUssUUFHdER4RSxFQUFXMEMsa0JBT0gsS0FBWlMsR0FDSWdCLElBQ0FILEVBQWEsRUFDTyxJQUFoQkssRUFDQUosRUFBVSxHQUVWRCxFQUFhOUIsRUFBV0MsS0FBSyxpQkFBaUJzQyxTQUFTQyxTQUN2RFQsRUFBVUQsRUFBYSxLQUNQSSxJQUNaSCxFQUFVLElBS2xCL0IsRUFBV0MsS0FBSyxVQUFVQyxZQUFZLFVBQ3RDRixFQUFXQyxLQUFLLE1BQU13QyxHQUFHVixHQUFTVyxTQUFTLEtBQUs1QyxTQUFTLFVBQ3pERSxFQUFXNUMsU0FBUzRDLEVBQVdDLEtBQUssbUJBTzVCLEtBQVpnQixHQUNJZ0IsSUFDQUgsRUFBYSxFQUNtQyxJQUE1QzlCLEVBQVdDLEtBQUssaUJBQWlCbEIsT0FDakNpRCxFQUFVLEdBRVZGLEVBQWE5QixFQUFXQyxLQUFLLGlCQUFpQnNDLFNBQVNDLFNBQ3ZEUixFQUFVRixFQUFhLEdBQ1QsSUFDVkUsRUFBV0UsRUFBYSxJQUtoQ2xDLEVBQVdDLEtBQUssVUFBVUMsWUFBWSxVQUN0Q0YsRUFBV0MsS0FBSyxNQUFNd0MsR0FBR1QsR0FBU1UsU0FBUyxLQUFLNUMsU0FBUyxVQUN6REUsRUFBVzVDLFNBQVM0QyxFQUFXQyxLQUFLLG9CQUloRDBDLGVBQWdCLFdBQ1osR0FBSUMsR0FBY3BHLEVBQUUsSUFBTXVCLEVBQVFXLGdDQUM5Qm1FLEVBQXFCckcsRUFBRSxJQUFNdUIsRUFBUVksdUNBQ3JDbUUsRUFBZ0J0RyxFQUFFLElBQU11QixFQUFRYSxrQ0FDaENtRSxFQUF1QnZHLEVBQUUsSUFBTXVCLEVBQVFjLHlDQUN2Q21FLEVBQW1CLEdBQ25CQyxFQUEwQixHQUMxQkMsRUFBcUIsR0FDckJDLEVBQTRCLEVBWWhDLE9BVklQLEdBQVk3RCxPQUFTLEdBQUs4RCxFQUFtQjlELE9BQVMsR0FBMkIsS0FBdEI2RCxFQUFZdEMsT0FBNkMsS0FBN0J1QyxFQUFtQnZDLFFBQzFHMEMsRUFBbUIsaUJBQW1CSSxtQkFBbUJSLEVBQVl0QyxPQUNyRTJDLEVBQTBCLHlCQUEyQkcsbUJBQW1CUCxFQUFtQnZDLFFBRzNGd0MsRUFBYy9ELE9BQVMsR0FBS2dFLEVBQXFCaEUsT0FBUyxHQUE2QixLQUF4QitELEVBQWN4QyxPQUErQyxLQUEvQnlDLEVBQXFCekMsUUFDbEg0QyxFQUFxQixvQkFBc0JFLG1CQUFtQk4sRUFBY3hDLE9BQzVFNkMsRUFBNEIsNEJBQThCQyxtQkFBbUJMLEVBQXFCekMsUUFHL0YwQyxFQUFtQkMsRUFBMEJDLEVBQXFCQyxHQUU3RTNDLGVBQWdCLFdBQ1osR0FBSTFDLEVBQVdzQyxnQkFBaUIsQ0FDNUIsR0FDSWlELEdBREE1QyxFQUFTakUsRUFBRSxJQUFNdUIsRUFBUUssWUFBYyxLQUFPTCxFQUFRTSxhQUl0RGdGLEdBREEvQixjQUFjZ0Msa0JBQ0d2RixFQUFRRSxlQUVSLElBQU16QixFQUFFLFFBQVErRyxLQUFLLFFBQVUsdUJBRXBEbkIsU0FBU0MsS0FBT2dCLEVBQWlCLE1BQVFELG1CQUFtQjNDLEVBQU9ILE1BQU1DLFFBQVV6QyxFQUFXNkUsbUJBR3RHYSxVQUFXLFNBQVNyRCxHQUNoQixHQUFJc0QsR0FBTUMsU0FBU0MsY0FBYyxNQUVqQyxPQURBRixHQUFJRyxVQUFZekQsRUFDVHNELEVBQUlJLGFBQWVKLEVBQUlLLFdBRWxDQyxTQUFVLFNBQVVDLEVBQU1DLEdBQ3RCLEdBQUlDLEdBQVExSCxFQUFFd0gsR0FDVkcsRUFBUSxFQU9aLE9BTkFELEdBQU1FLEtBQUssU0FBU0MsRUFBS3pELEdBQ3JCLEdBQUdBLEVBQUkwRCxJQUFNTCxFQUVULFlBREFFLEVBQVF2RCxFQUFJMkQsS0FJYkosR0FFWHZDLGVBQWdCLGVBQ2EsS0FBZC9ELFdBQ1BBLFVBQVUyRyxTQUdsQkMsY0FBZSxTQUFTQyxFQUFZQyxHQUNoQyxHQUdJQyxHQUNBQyxFQUpBQyxFQUFPdEksRUFBRSxRQUFRK0csS0FBSyxRQUt0QndCLEVBQWMsRUFHZEMsRUFBYUMsV0FBZUgsRUFDNUI5RyxFQUFvQkQsRUFBUUMsa0JBRTVCa0gsRUFBTTFJLEVBQUUwSSxNQUVSekUsR0FETXlFLEVBQUlDLE1BQU0sVUFDUDNJLEVBQUUsSUFBTXVCLEVBQVFLLFlBQWMsS0FBT0wsRUFBUU0sZUFDdEQrRyxFQUFJM0UsRUFBT0gsTUFDWCtFLEVBQWEsR0FDYkMsRUFBa0I5SSxFQUFFLElBQU11QixFQUFRVyxnQ0FDbEM2RyxFQUFvQi9JLEVBQUUsSUFBTXVCLEVBQVFhLGlDQUV4QyxJQUFJZCxFQUFXc0MsZ0JBQWlCLEtBQ0YsS0FBZnNFLElBQ1BLLEdBQWVMLEVBQWEsR0FBSzFHLE9BRVAsS0FBbkIyRyxJQUNQM0csRUFBb0IyRyxHQUVDLGdCQUFyQk8sRUFBSTVDLEtBQUssU0FDVHNDLEVBQWdCLCtDQUNDLGtCQUVqQkEsRUFBZ0Isb0RBQ0MseUJBTVUsS0FBcEJVLEdBQW1DQSxFQUFnQnZHLE9BQVMsR0FBK0IsS0FBMUJ1RyxFQUFnQmhGLFFBQ3hGK0UsRUFBYSxnQkFBa0JDLEVBQWdCaEYsV0FFbEIsS0FBdEJpRixHQUFxQ0EsRUFBa0J4RyxPQUFTLEdBQWlDLEtBQTVCd0csRUFBa0JqRixRQUMzRSxLQUFmK0UsSUFDQUEsR0FBYyxLQUVsQkEsR0FBYyxtQkFBcUJFLEVBQWtCakYsT0FJekR1RSxHQUNJVyxPQUFVLGFBQ1ZDLEdBQU0sT0FDTkMsR0FBTSxPQUNOQyxVQUFhLElBQ2JDLE9BQVUsRUFDVmQsS0FBUSxxQkFDUkcsT0FBVUQsRUFDVkksRUFBS0EsRUFDTFMsTUFBU2QsRUFDVGUsSUFBTzlILEVBQ1ArSCxNQUFTLElBQ1RDLGVBQWtCWCxFQVF0QixRQUpJVCxjQUFpQkEsRUFDakJDLFdBQWNBLEdBS2xCLE1BQU8sT0FJZmxELFlBQWEsV0FDVCxHQUFJc0UsR0FBY25JLEVBQVcyRyxlQUU3QjNHLEdBQVc4RCxpQkFHWC9ELFVBQVlyQixFQUFFMEosTUFDVkMsS0FBTSxNQUNOakIsSUFBS2UsRUFBWXJCLGNBQ2pCckIsS0FBTTBDLEVBQVlwQixXQUNsQnVCLFNBQVUsT0FDVkMsT0FBTyxFQUNQQyxPQUFPLEVBQ1BDLE9BQU8sRUFDUEMsUUFBUyxTQUFTakQsR0FHZCxHQUFJeEQsR0FBa0J2RCxFQUFFLElBQU11QixFQUFRUSx1QkFDbENrSSxFQUFnQjFHLEVBQWdCRSxLQUFLLElBQU1sQyxFQUFRUyxzQkFFdkRWLEdBQVc0SSxvQkFBb0JuRCxFQUFNa0QsRUFBZSxTQUFTRSxHQUNyREEsRUFBYSxHQUNiN0ksRUFBVytCLHdCQU12QitHLE1BQU8sU0FBU0MsUUFLeEJILG9CQUFxQixTQUFTbkQsRUFBTXVELEVBQWlCbkssR0FFakQsR0FBSW9LLEdBQ0FKLEVBQWEsRUFDYkssRUFBVSxHQUNWQyxFQUFXLEdBQ1hDLEVBQWEsR0FDYkMsRUFBUyxFQUViLFFBQXdCLEtBQWI1RCxFQUFLNkQsU0FBK0MsS0FBakI3RCxFQUFLNkQsSUFBSUMsSUFHbkQsR0FGQVYsRUFBYXBELEVBQUs2RCxJQUFJQyxJQUFJQyxNQUVXLEtBQTFCL0QsRUFBSzZELElBQUlDLElBQUlFLEVBQUV4SSxPQUF3QixDQUM5Q2dJLEVBQVN4RCxFQUFLNkQsSUFBSUMsSUFBSUUsQ0FDdEIsS0FBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlULEVBQU9oSSxPQUFReUksSUFBSyxDQUNwQ1IsRUFBVWxKLEVBQVdpRyxTQUFTZ0QsRUFBT1MsR0FBR0MsR0FBSSxnQkFDNUNSLEVBQVduSixFQUFXMEYsVUFBVXVELEVBQU9TLEdBQUdFLEdBQzFDUixFQUFhcEosRUFBVzBGLFVBQVUxRixFQUFXaUcsU0FBU2dELEVBQU9TLEdBQUdDLEdBQUksZ0JBQWtCM0osRUFBVzBGLFVBQVUxRixFQUFXaUcsU0FBU2dELEVBQU9TLEdBQUdDLEdBQUksZ0JBQWtCM0osRUFBVzBGLFVBQVV1RCxFQUFPUyxHQUFHRyxHQUc5TFIsRUFBU0osRUFBT1MsR0FBR0ksQ0FHbkIsSUFBSUMsSUFDQUMsTUFBU2IsRUFDVGMsS0FBUWIsRUFDUmhDLElBQU9pQyxFQUNQYSxLQUFRaEIsRUFHWkYsR0FBZ0JtQixPQUFPQyxLQUFLLG9CQUFxQkwsU0FFbEQsQ0FDSCxHQUFJTSxHQUFTNUUsRUFBSzZELElBQUlDLElBQUlFLENBQzFCUCxHQUFVbEosRUFBV2lHLFNBQVNvRSxFQUFPVixHQUFJLGdCQUN6Q1IsRUFBV25KLEVBQVcwRixVQUFVMkUsRUFBT1QsR0FDdkNSLEVBQWFwSixFQUFXaUcsU0FBU29FLEVBQU9WLEdBQUksZUFBaUIzSixFQUFXaUcsU0FBU29FLEVBQU9WLEdBQUksZUFBaUIzSixFQUFXMEYsVUFBVTJFLEVBQU9SLEdBQ3pJUixFQUFTZ0IsRUFBT1AsQ0FHaEIsSUFBSVEsSUFDQU4sTUFBU2IsRUFDVGMsS0FBUWIsRUFDUmhDLElBQU9pQyxFQUNQYSxLQUFRaEIsRUFHWkYsR0FBZ0JtQixPQUFPQyxLQUFLLG9CQUFxQkUsSUFJekR6TCxFQUFTZ0ssSUFJakIsT0FBTzdJLEtBR1h0QixHQUFFa0gsVUFBVTJFLE1BQU0sV0FDZCxZQUNBdkssWUFBV2dCIiwiZmlsZSI6ImxpYi9zbWFydC1zZWFyY2guanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzbWFydCBzZWFyY2hcbi8qZ2xvYmFsIHRtcGwsIGRlbGF5S2V5dXAsIGNvbW1vblNldHRpbmcqL1xuKGZ1bmN0aW9uKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLypqcXVlcnkgcGx1Z2luOiBkZWxheSBrZXkgdXAqL1xuICAgICQuZm4uZGVsYXlLZXl1cCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBtcykge1xuICAgICAgICB2YXIgdGltZXIgPSAwO1xuICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICQodGhpcykua2V5dXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlbCwgZSk7XG4gICAgICAgICAgICB9LCBtcyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gJCh0aGlzKTtcbiAgICB9O1xuXG4gICAgJC5mbi5zY3JvbGxUbyA9IGZ1bmN0aW9uKGVsZW0sIHNwZWVkKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCQoZWxlbSkpO1xuICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe1xuICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKHRoaXMpLnNjcm9sbFRvcCgpIC0gJCh0aGlzKS5vZmZzZXQoKS50b3AgKyAkKGVsZW0pLm9mZnNldCgpLnRvcCAtIDIwXG4gICAgICAgIH0sIHNwZWVkID09PSB1bmRlZmluZWQgPyA0MDAgOiBzcGVlZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG59KGpRdWVyeSkpO1xuXG52YXIgX2FqYXhDYWxsO1xuXG52YXIgc2VhcmNoRGF0YSA9IChmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHNldHRpbmcgPSB7XG4gICAgICAgICAgICAncmVzdWx0c1BlclJlcXVlc3QnOiA1LFxuICAgICAgICAgICAgJ3Jlc3VsdFBhZ2VQYXRoJzogJ3NlYXJjaC1yZXN1bHQuaHRtJyxcbiAgICAgICAgICAgICdtaW5TZWFyY2hXb3Jkcyc6ICczJyxcbiAgICAgICAgICAgICdjbHNOYW1lQXNwRG90TmV0Rm9ybSc6ICdzdXBwb3J0LWZvcm0nLFxuICAgICAgICAgICAgJ2Nsc05hbWVGb3JtJzogJ3NlYXJjaC1ib3gnLFxuICAgICAgICAgICAgJ2Nsc05hbWVJbnB1dCc6ICdpbnB1dC1xdWVyeScsXG4gICAgICAgICAgICAnY2xzTmFtZUJ1dHRvblN1Ym1pdCc6ICdidXR0b24tc3VibWl0JyxcbiAgICAgICAgICAgICdjbHNOYW1lU3VnZ2VzdGlvbkFyZWEnOiAnc21hcnQtc2VhcmNoLXJlc3VsdC1jb250YWluZXInLFxuICAgICAgICAgICAgJ2Nsc05hbWVTdWdnZXN0aW9uTGlzdCc6ICdzZWFyY2gtcmVzdWx0JyxcbiAgICAgICAgICAgICdjbHNOYW1lQ2xvc2VCdG4nOiAnY2xvc2UtcmVzdWx0ZS1jb250YWluZXItYnRuJyxcbiAgICAgICAgICAgICdjbHNOYW1lSGlkZGVuU2VhcmNoQ29udGVudFR5cGUnOiAnaGlkZGVuLXNlYXJjaC1jb250ZW50LXR5cGUnLFxuICAgICAgICAgICAgJ2Nsc05hbWVIaWRkZW5TZWFyY2hDb250ZW50VHlwZURpc3BsYXknOiAnaGlkZGVuLXNlYXJjaC1jb250ZW50LXR5cGUtZGlzcGxheScsXG4gICAgICAgICAgICAnY2xzTmFtZUhpZGRlblNlYXJjaFByb2R1Y3ROYW1lSWQnOiAnaGlkZGVuLXNlYXJjaC1wcm9kdWN0LW5hbWUtaWQnLFxuICAgICAgICAgICAgJ2Nsc05hbWVIaWRkZW5TZWFyY2hQcm9kdWN0TmFtZUlkRGlzcGxheSc6ICdoaWRkZW4tc2VhcmNoLXByb2R1Y3QtbmFtZS1pZC1kaXNwbGF5J1xuICAgICAgICB9LFxuICAgICAgICBpbml0ID0gZmFsc2U7XG5cbiAgICB2YXIgc2VhcmNoRGF0YSA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL29ubHkgdHJpZ2dlciBvbmNlXG4gICAgICAgICAgICBpZiAoIWluaXQgJiYgJCgnLnNlYXJjaC1ib3gnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5kaXNhYmxlRGVmYXVsdEZyb21TdWJtaXQoKTtcbiAgICAgICAgICAgICAgICBzZWFyY2hEYXRhLmRldGVjdElucHV0S2V5KCk7XG4gICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5zZXR1cFN1Ym1pdCgpO1xuICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuc2V0dXBTaG93QWxsUmVzdWx0TGluaygpO1xuICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuc2V0dXBDbG9zZVJlc3VsdENvbnRhaW5lckJ1dHRvbigpO1xuICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuc2V0dXBPdXRPZlNlYXJjaEFyZWFDbGljaygpO1xuICAgICAgICAgICAgICAgIGluaXQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkaXNhYmxlRGVmYXVsdEZyb21TdWJtaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLicgKyBzZXR0aW5nLmNsc05hbWVBc3BEb3ROZXRGb3JtKS5vbignc3VibWl0JywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldHVwT3V0T2ZTZWFyY2hBcmVhQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJChldmVudC50YXJnZXQpKTtcbiAgICAgICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdzZWFyY2gtYm94JykgfHxcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdpY29uLXNlYXJjaCcpIHx8XG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcygnaW5wdXQtcXVlcnknKSB8fFxuICAgICAgICAgICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkuaGFzQ2xhc3MoJ3NtYXJ0LXNlYXJjaC1yZXN1bHQtY29udGFpbmVyJykgfHxcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdib3JkZXItYXJlYScpIHx8XG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcygnc2hvdy1hbGwtcmVzdWx0JykgfHxcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdidXR0b24tc3VibWl0JykgfHxcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdzZWFyY2gtcmVzdWx0JykgfHxcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdzZWFyY2gtcmVzdWx0LWRhdGEnKSB8fFxuICAgICAgICAgICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkuaGFzQ2xhc3MoJ3NlYXJjaC1kYXRhLWltZycpIHx8XG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcygnc2VhcmNoLWRhdGEtaW5mbycpIHx8XG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcygnc2VhcmNoLWRhdGEtdGl0bGUnKSB8fFxuICAgICAgICAgICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkuaGFzQ2xhc3MoJ3NlYXJjaC1kYXRhLWRlc2MnKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5oaWRlU3VnZ2VzdGlvbkxpc3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0dXBDbG9zZVJlc3VsdENvbnRhaW5lckJ1dHRvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgY2xvc2VCdG4gPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUNsb3NlQnRuKTtcbiAgICAgICAgICAgIGNsb3NlQnRuLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5oaWRlU3VnZ2VzdGlvbkxpc3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBzaG93U3VnZ2VzdGlvbkxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdENvbnRhaW5lciA9ICQoJy4nICsgc2V0dGluZy5jbHNOYW1lU3VnZ2VzdGlvbkFyZWEpO1xuICAgICAgICAgICAgcmVzdWx0Q29udGFpbmVyLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGVTdWdnZXN0aW9uTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0Q29udGFpbmVyID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVTdWdnZXN0aW9uQXJlYSksXG4gICAgICAgICAgICAgICAgcmVzdWx0TGlzdCA9IHJlc3VsdENvbnRhaW5lci5maW5kKCcuJyArIHNldHRpbmcuY2xzTmFtZVN1Z2dlc3Rpb25MaXN0KTtcbiAgICAgICAgICAgIHJlc3VsdENvbnRhaW5lci5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgcmVzdWx0TGlzdC5odG1sKCcnKTtcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRhdGVRdWVyeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgJGlucHV0ID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVGb3JtICsgJyAuJyArIHNldHRpbmcuY2xzTmFtZUlucHV0KTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJGlucHV0LnZhbCgpKTtcbiAgICAgICAgICAgIGlmICgkaW5wdXQudmFsKCkudHJpbSgpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0dXBTdWJtaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRzdWJtaXQgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUZvcm0gKyAnIC4nICsgc2V0dGluZy5jbHNOYW1lQnV0dG9uU3VibWl0KTtcbiAgICAgICAgICAgICRzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5nb1RvUmVzdWx0UGFnZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldHVwU2hvd0FsbFJlc3VsdExpbms6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRzdWJtaXQgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZVN1Z2dlc3Rpb25BcmVhICsgJyAuJyArIHNldHRpbmcuY2xzTmFtZUJ1dHRvblN1Ym1pdCk7XG4gICAgICAgICAgICAkc3VibWl0Lm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuZ29Ub1Jlc3VsdFBhZ2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBkZXRlY3RJbnB1dEtleTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJGlucHV0ID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVGb3JtICsgJyAuJyArIHNldHRpbmcuY2xzTmFtZUlucHV0KTtcbiAgICAgICAgICAgICRpbnB1dC5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5zZWxlY3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gLmJsdXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyAgICAgc2VhcmNoRGF0YS5oaWRlU3VnZ2VzdGlvbkxpc3QoKTtcbiAgICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgICAgJGlucHV0LmRlbGF5S2V5dXAoZnVuY3Rpb24ob2JqLCBldnQpIHtcbiAgICAgICAgICAgICAgICBldnQgPSBldnQgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGV2dC53aGljaCB8fCBldnQua2V5Q29kZTtcbiAgICAgICAgICAgICAgICB2YXIgY2hhclN0ciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpO1xuICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHZhciBrZXlQYXNzID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY2hhckNvZGU9JyArIGNoYXJDb2RlKTtcblxuICAgICAgICAgICAgICAgIGlmICghY29tbW9uU2V0dGluZy5pc01vYmlsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgvW2EtejAtOV0vaS50ZXN0KGNoYXJTdHIpIHx8IGNoYXJDb2RlID09PSA4IHx8IGNoYXJDb2RlID09PSAzMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIExldHRlciBvciBudW1iZXIgdHlwZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGNoYXJDb2RlID09IDggLS0+IGJhY2tzcGFjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICogY2hhckNvZGUgPT0gMzIgLS0+IHNwYWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleVBhc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGFzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGtleVBhc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBvYmoudmFsKCksXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5UZXJtcyA9IHNldHRpbmcubWluU2VhcmNoV29yZHM7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5oaWRlU3VnZ2VzdGlvbkxpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlcm0ubGVuZ3RoID49IG1pblRlcm1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZ2V0SnNvbkRhdGEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcuJyArIHNldHRpbmcuY2xzTmFtZUZvcm0pLmhhc0NsYXNzKCdzaG93LXN1Z2dlc3Rpb24tbGlzdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5nZXRKc29uRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoRGF0YS5jYW5jbGVBamF4Q2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICBzZWFyY2hEYXRhLnNldHVwRG93bkFuZFVwS2V5RXZlbnQoY2hhckNvZGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldHVwRG93bkFuZFVwS2V5RXZlbnQ6IGZ1bmN0aW9uKGtleUNvZGUpIHtcbiAgICAgICAgICAgIHZhciBoYXNSZXN1bHQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXN1bHRDb250YWluZXIgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZVN1Z2dlc3Rpb25BcmVhKSxcbiAgICAgICAgICAgICAgICByZXN1bHRMaXN0ID0gcmVzdWx0Q29udGFpbmVyLmZpbmQoJy4nICsgc2V0dGluZy5jbHNOYW1lU3VnZ2VzdGlvbkxpc3QpLFxuICAgICAgICAgICAgICAgIHRvdGFsSXRlbXMgPSByZXN1bHRMaXN0LmZpbmQoJ2xpJykubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGFjdGl2ZUNvdW50ID0gcmVzdWx0TGlzdC5maW5kKCdsaSA+IGEuYWN0aXZlJykubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRJZHgsXG4gICAgICAgICAgICAgICAgbmV4dElkeCxcbiAgICAgICAgICAgICAgICBwcmV2SWR4LFxuICAgICAgICAgICAgICAgICRpbnB1dCA9ICQoJy4nICsgc2V0dGluZy5jbHNOYW1lRm9ybSArICcgLicgKyBzZXR0aW5nLmNsc05hbWVJbnB1dCk7XG5cblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3RvdGFsSXRlbXM9JyArIHRvdGFsSXRlbXMpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2FjdGl2ZUNvdW50PScgKyBhY3RpdmVDb3VudCk7XG5cbiAgICAgICAgICAgIGlmICh0b3RhbEl0ZW1zID4gMCkge1xuICAgICAgICAgICAgICAgIGhhc1Jlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgKiBFbnRlciBrZXlcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09IDEzKSB7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2tleUNvZGU9JyArIGtleUNvZGUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGhhc1Jlc3VsdCAmJiBhY3RpdmVDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICogR28gdG8gaXRlbSBsaW5rXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZ28gdG8gaG93dG8nKTtcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IHJlc3VsdExpc3QuZmluZCgnbGkgPiBhLmFjdGl2ZScpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZ28gdG8gc2VhcmNoJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuZ29Ub1Jlc3VsdFBhZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgKiBEb3duYXJyb3cga2V5XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSA0MCkge1xuICAgICAgICAgICAgICAgIGlmIChoYXNSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudElkeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElkeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SWR4ID0gcmVzdWx0TGlzdC5maW5kKCdsaSA+IGEuYWN0aXZlJykucGFyZW50KCkuaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJZHggPSBjdXJyZW50SWR4ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0SWR4ID09PSB0b3RhbEl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElkeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2N1cnJlbnRJZHg9JyArIGN1cnJlbnRJZHgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnbmV4dElkeD0nICsgbmV4dElkeCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuZmluZCgnbGkgPiBhJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0LmZpbmQoJ2xpJykuZXEobmV4dElkeCkuY2hpbGRyZW4oJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3Quc2Nyb2xsVG8ocmVzdWx0TGlzdC5maW5kKCdsaSA+IGEuYWN0aXZlJykpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAqIFVwYXJyb3cga2V5XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSAzOCkge1xuICAgICAgICAgICAgICAgIGlmIChoYXNSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudElkeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRMaXN0LmZpbmQoJ2xpID4gYS5hY3RpdmUnKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJZHggPSAwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudElkeCA9IHJlc3VsdExpc3QuZmluZCgnbGkgPiBhLmFjdGl2ZScpLnBhcmVudCgpLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2SWR4ID0gY3VycmVudElkeCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldklkeCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2SWR4ID0gKHRvdGFsSXRlbXMgLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY3VycmVudElkeD0nICsgY3VycmVudElkeCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdwcmV2SWR4PScgKyBwcmV2SWR4KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5maW5kKCdsaSA+IGEnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuZmluZCgnbGknKS5lcShwcmV2SWR4KS5jaGlsZHJlbignYScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TGlzdC5zY3JvbGxUbyhyZXN1bHRMaXN0LmZpbmQoJ2xpID4gYS5hY3RpdmUnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzZXR1cFVybFBhcmFtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlKSxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZURpc3BsYXkgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlRGlzcGxheSksXG4gICAgICAgICAgICAgICAgcHJvZHVjdE5hbWVJZCA9ICQoJy4nICsgc2V0dGluZy5jbHNOYW1lSGlkZGVuU2VhcmNoUHJvZHVjdE5hbWVJZCksXG4gICAgICAgICAgICAgICAgcHJvZHVjdE5hbWVJZERpc3BsYXkgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUhpZGRlblNlYXJjaFByb2R1Y3ROYW1lSWREaXNwbGF5KSxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZVBhcmFtID0gJycsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGVEaXNwbGF5UGFyYW0gPSAnJyxcbiAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZUlkUGFyYW0gPSAnJyxcbiAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZUlkRGlzcGxheVBhcmFtID0gJyc7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjb250ZW50VHlwZSk7XG4gICAgICAgICAgICBpZiAoY29udGVudFR5cGUubGVuZ3RoID4gMCAmJiBjb250ZW50VHlwZURpc3BsYXkubGVuZ3RoID4gMCAmJiBjb250ZW50VHlwZS52YWwoKSAhPT0gJycgJiYgY29udGVudFR5cGVEaXNwbGF5LnZhbCgpICE9PSAnJykge1xuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlUGFyYW0gPSAnJmNvbnRlbnRfdHlwZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGNvbnRlbnRUeXBlLnZhbCgpKTtcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZURpc3BsYXlQYXJhbSA9ICcmY29udGVudF90eXBlX2Rpc3BsYXk9JyArIGVuY29kZVVSSUNvbXBvbmVudChjb250ZW50VHlwZURpc3BsYXkudmFsKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZHVjdE5hbWVJZC5sZW5ndGggPiAwICYmIHByb2R1Y3ROYW1lSWREaXNwbGF5Lmxlbmd0aCA+IDAgJiYgcHJvZHVjdE5hbWVJZC52YWwoKSAhPT0gJycgJiYgcHJvZHVjdE5hbWVJZERpc3BsYXkudmFsKCkgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcHJvZHVjdE5hbWVJZFBhcmFtID0gJyZwcm9kdWN0X25hbWVfaWQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChwcm9kdWN0TmFtZUlkLnZhbCgpKTtcbiAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZUlkRGlzcGxheVBhcmFtID0gJyZwcm9kdWN0X25hbWVfaWRfZGlzcGxheT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHByb2R1Y3ROYW1lSWREaXNwbGF5LnZhbCgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnRUeXBlUGFyYW0gKyBjb250ZW50VHlwZURpc3BsYXlQYXJhbSArIHByb2R1Y3ROYW1lSWRQYXJhbSArIHByb2R1Y3ROYW1lSWREaXNwbGF5UGFyYW07XG4gICAgICAgIH0sXG4gICAgICAgIGdvVG9SZXN1bHRQYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChzZWFyY2hEYXRhLnZhbGlkYXRlUXVlcnkoKSkge1xuICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUZvcm0gKyAnIC4nICsgc2V0dGluZy5jbHNOYW1lSW5wdXQpLFxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYWdlUGF0aDtcblxuICAgICAgICAgICAgICAgIGlmIChjb21tb25TZXR0aW5nLmlzUHJvdG90eXBlSG9zdCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFBhZ2VQYXRoID0gc2V0dGluZy5yZXN1bHRQYWdlUGF0aDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYWdlUGF0aCA9ICcvJyArICQoJ2JvZHknKS5kYXRhKCdzaXRlJykgKyAnL3N1cHBvcnQvc2VhcmNoLmFzcHgnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gc2VhcmNoUGFnZVBhdGggKyAnP3E9JyArIGVuY29kZVVSSUNvbXBvbmVudCgkaW5wdXQudmFsKCkudHJpbSgpKSArIHNlYXJjaERhdGEuc2V0dXBVcmxQYXJhbXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3RyaXBIVE1MOiBmdW5jdGlvbihodG1sKSB7XG4gICAgICAgICAgICB2YXIgdG1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0bXAuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgIHJldHVybiB0bXAudGV4dENvbnRlbnQgfHwgdG1wLmlubmVyVGV4dDtcbiAgICAgICAgfSxcbiAgICAgICAgZmluZE1ldGE6IGZ1bmN0aW9uIChtZXRhLCBtZXRhTmFtZSkge1xuICAgICAgICAgICAgdmFyICRtZXRhID0gJChtZXRhKSxcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnO1xuICAgICAgICAgICAgJG1ldGEuZWFjaChmdW5jdGlvbihpZHgsIG9iaikge1xuICAgICAgICAgICAgICAgIGlmKG9iai5OID09PSBtZXRhTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iai5WO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vdGhpcyBpcyBqdXN0IGEgbG9vcCBicmVha1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBjYW5jbGVBamF4Q2FsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIF9hamF4Q2FsbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBfYWpheENhbGwuYWJvcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0dXBBamF4Q2FsbDogZnVuY3Rpb24ocGFnZU51bWJlciwgcmVzdWx0c1BlclBhZ2UpIHtcbiAgICAgICAgICAgIHZhciBzaXRlID0gJCgnYm9keScpLmRhdGEoJ3NpdGUnKSxcbiAgICAgICAgICAgICAgICBzaXRlU2VhcmNoID0gJycsXG4gICAgICAgICAgICAgICAgc2l0ZVNlYXJjaEhvc3QgPSAnJyxcbiAgICAgICAgICAgICAgICBiYXNlU2VhcmNoVVJMLFxuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW0sXG4gICAgICAgICAgICAgICAgc3RhcnROdW1iZXIgPSAwLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5ID0gJ3N1cHBvcnQnLFxuICAgICAgICAgICAgICAgIGNsaWVudCA9ICdzdXBwb3J0JyxcbiAgICAgICAgICAgICAgICBjbGllbnROYW1lID0gY2xpZW50ICsgJy0nICsgc2l0ZSxcbiAgICAgICAgICAgICAgICByZXN1bHRzUGVyUmVxdWVzdCA9IHNldHRpbmcucmVzdWx0c1BlclJlcXVlc3QsXG4gICAgICAgICAgICAgICAgdG90YWxDb3VudCxcbiAgICAgICAgICAgICAgICB1cmwgPSAkLnVybCgpLFxuICAgICAgICAgICAgICAgIHBpZCA9IHVybC5wYXJhbSgncF9uYW1lJyksXG4gICAgICAgICAgICAgICAgJGlucHV0ID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVGb3JtICsgJyAuJyArIHNldHRpbmcuY2xzTmFtZUlucHV0KSxcbiAgICAgICAgICAgICAgICBxID0gJGlucHV0LnZhbCgpLFxuICAgICAgICAgICAgICAgIG1ldGFGaWx0ZXIgPSAnJyxcbiAgICAgICAgICAgICAgICBtZXRhQ29udGVudFR5cGUgPSAkKCcuJyArIHNldHRpbmcuY2xzTmFtZUhpZGRlblNlYXJjaENvbnRlbnRUeXBlKSxcbiAgICAgICAgICAgICAgICBtZXRhUHJvZHVjdE5hbWVJZCA9ICQoJy4nICsgc2V0dGluZy5jbHNOYW1lSGlkZGVuU2VhcmNoUHJvZHVjdE5hbWVJZCk7XG5cbiAgICAgICAgICAgIGlmIChzZWFyY2hEYXRhLnZhbGlkYXRlUXVlcnkoKSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFnZU51bWJlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnROdW1iZXIgPSAocGFnZU51bWJlciAtIDEpICogcmVzdWx0c1BlclJlcXVlc3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0c1BlclBhZ2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHNQZXJSZXF1ZXN0ID0gcmVzdWx0c1BlclBhZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh1cmwuYXR0cignaG9zdCcpID09PSAnd3d3Lmh0Yy5jb20nKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VTZWFyY2hVUkwgPSAnLy93cy5odGMuY29tL2h0Yy1zZWFyY2gtMS4xL3F1ZXJ5L2dzYS9zZWFyY2gnO1xuICAgICAgICAgICAgICAgICAgICBzaXRlU2VhcmNoSG9zdCA9ICcvL3d3dy5odGMuY29tJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBiYXNlU2VhcmNoVVJMID0gJy8vZGV2Mi13cy5odGMuY29tL2h0Yy1zZWFyY2gtMS4xL3F1ZXJ5L2dzYS9zZWFyY2gnO1xuICAgICAgICAgICAgICAgICAgICBzaXRlU2VhcmNoSG9zdCA9ICcvL2Rldi13d3cuaHRjLmNvbSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9GaWx0ZXIgbWV0YSB0YWdzXG4gICAgICAgICAgICAgICAgLy9SZWZlcmVuY2U6IGh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vc3VwcG9ydC9lbnRlcnByaXNlL3N0YXRpYy9nc2EvZG9jcy9hZG1pbi83Mi9nc2FfZG9jX3NldC94bWxfcmVmZXJlbmNlL3JlcXVlc3RfZm9ybWF0Lmh0bWwjMTA3Nzc1NlxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG1ldGFDb250ZW50VHlwZSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXRhQ29udGVudFR5cGUgIT09ICd1bmRlZmluZWQnICYmIG1ldGFDb250ZW50VHlwZS5sZW5ndGggPiAwICYmIG1ldGFDb250ZW50VHlwZS52YWwoKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0YUZpbHRlciA9ICdjb250ZW50X3R5cGU6JyArIG1ldGFDb250ZW50VHlwZS52YWwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXRhUHJvZHVjdE5hbWVJZCAhPT0gJ3VuZGVmaW5lZCcgJiYgbWV0YVByb2R1Y3ROYW1lSWQubGVuZ3RoID4gMCAmJiBtZXRhUHJvZHVjdE5hbWVJZC52YWwoKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGFGaWx0ZXIgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRhRmlsdGVyICs9ICcuJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBtZXRhRmlsdGVyICs9ICdwcm9kdWN0X25hbWVfaWQ6JyArIG1ldGFQcm9kdWN0TmFtZUlkLnZhbCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGxvYWQgcHJvZHVjdCBzZWFyY2ggcmVzdWx0c1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgICAgICdvdXRwdXQnOiAneG1sX25vX2R0ZCcsXG4gICAgICAgICAgICAgICAgICAgICdpZSc6ICd1dGY4JyxcbiAgICAgICAgICAgICAgICAgICAgJ29lJzogJ3V0ZjgnLFxuICAgICAgICAgICAgICAgICAgICAnZ2V0ZmllbGRzJzogJyonLFxuICAgICAgICAgICAgICAgICAgICAnZmlsdGVyJzogMCxcbiAgICAgICAgICAgICAgICAgICAgJ3NpdGUnOiAnZGVmYXVsdF9jb2xsZWN0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgJ2NsaWVudCc6IGNsaWVudE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICdxJzogcSxcbiAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0Jzogc3RhcnROdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICdudW0nOiByZXN1bHRzUGVyUmVxdWVzdCxcbiAgICAgICAgICAgICAgICAgICAgJ2FzX2R0JzogJ2knLFxuICAgICAgICAgICAgICAgICAgICAncmVxdWlyZWRmaWVsZHMnOiBtZXRhRmlsdGVyXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgJ2Jhc2VTZWFyY2hVUkwnOiBiYXNlU2VhcmNoVVJMLFxuICAgICAgICAgICAgICAgICAgICAncXVlcnlQYXJhbSc6IHF1ZXJ5UGFyYW1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLy8gc2VhcmNoIGFuZCBnZXQganNvbiBkYXRhXG4gICAgICAgIGdldEpzb25EYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBhamF4U2V0dGluZyA9IHNlYXJjaERhdGEuc2V0dXBBamF4Q2FsbCgpO1xuICAgICAgICAgICAgLy9pZiBhamF4IGlzIGNhbGxpbmcsIGNhbmNsZSBpdCBmaXJzdDtcbiAgICAgICAgICAgIHNlYXJjaERhdGEuY2FuY2xlQWpheENhbGwoKTtcblxuICAgICAgICAgICAgLy9DYWxsIGFqYXhcbiAgICAgICAgICAgIF9hamF4Q2FsbCA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBhamF4U2V0dGluZy5iYXNlU2VhcmNoVVJMLFxuICAgICAgICAgICAgICAgIGRhdGE6IGFqYXhTZXR0aW5nLnF1ZXJ5UGFyYW0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBqc29ucDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAvL2dldCByZXNwb25jZSBhcnJheVxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0Q29udGFpbmVyID0gJCgnLicgKyBzZXR0aW5nLmNsc05hbWVTdWdnZXN0aW9uQXJlYSksXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRMaXN0RGl2ID0gcmVzdWx0Q29udGFpbmVyLmZpbmQoJy4nICsgc2V0dGluZy5jbHNOYW1lU3VnZ2VzdGlvbkxpc3QpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaERhdGEuYnVpbGRSZXN1bHRUZW1wbGF0ZShkYXRhLCByZXN1bHRMaXN0RGl2LCBmdW5jdGlvbih0b3RhbENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hEYXRhLnNob3dTdWdnZXN0aW9uTGlzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJ1aWxkUmVzdWx0VGVtcGxhdGU6IGZ1bmN0aW9uKGRhdGEsIGFwcGVuZENvbnRhaW5lciwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGFwcGVuZENvbnRhaW5lcik7XG4gICAgICAgICAgICB2YXIgakFycmF5LFxuICAgICAgICAgICAgICAgIHRvdGFsQ291bnQgPSAwLFxuICAgICAgICAgICAgICAgIHRtcEljb24gPSAnJyxcbiAgICAgICAgICAgICAgICB0bXBUaXRsZSA9ICcnLFxuICAgICAgICAgICAgICAgIHRtcERlc2NyaXAgPSAnJyxcbiAgICAgICAgICAgICAgICB0bXBVcmwgPSAnJztcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLkdTUCAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGRhdGEuR1NQLlJFUyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB0b3RhbENvdW50ID0gZGF0YS5HU1AuUkVTLk07XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEuR1NQLlJFUy5SLmxlbmd0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgakFycmF5ID0gZGF0YS5HU1AuUkVTLlI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgakFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXBJY29uID0gc2VhcmNoRGF0YS5maW5kTWV0YShqQXJyYXlbaV0uTVQsICdjb250ZW50X3R5cGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcFRpdGxlID0gc2VhcmNoRGF0YS5zdHJpcEhUTUwoakFycmF5W2ldLlQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG1wRGVzY3JpcCA9IHNlYXJjaERhdGEuc3RyaXBIVE1MKHNlYXJjaERhdGEuZmluZE1ldGEoakFycmF5W2ldLk1ULCAnZGVzY3JpcHRpb24nKSkgPyBzZWFyY2hEYXRhLnN0cmlwSFRNTChzZWFyY2hEYXRhLmZpbmRNZXRhKGpBcnJheVtpXS5NVCwgJ2Rlc2NyaXB0aW9uJykpIDogc2VhcmNoRGF0YS5zdHJpcEhUTUwoakFycmF5W2ldLlMpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcFVybCA9IGpBcnJheVtpXS5VO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndG1wSWNvbj0nICsgdG1wSWNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0RGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiB0bXBUaXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzYyc6IHRtcERlc2NyaXAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHRtcFVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWNvbic6IHRtcEljb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENvbnRhaW5lci5hcHBlbmQodG1wbCgnc2VhcmNoLXJlc3VsdC10bXAnLCByZXN1bHREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb25EYXRhID0gZGF0YS5HU1AuUkVTLlI7XG4gICAgICAgICAgICAgICAgICAgIHRtcEljb24gPSBzZWFyY2hEYXRhLmZpbmRNZXRhKG9uRGF0YS5NVCwgJ2NvbnRlbnRfdHlwZScpO1xuICAgICAgICAgICAgICAgICAgICB0bXBUaXRsZSA9IHNlYXJjaERhdGEuc3RyaXBIVE1MKG9uRGF0YS5UKTtcbiAgICAgICAgICAgICAgICAgICAgdG1wRGVzY3JpcCA9IHNlYXJjaERhdGEuZmluZE1ldGEob25EYXRhLk1ULCAnZGVzY3JpcHRpb24nKSA/IHNlYXJjaERhdGEuZmluZE1ldGEob25EYXRhLk1ULCAnZGVzY3JpcHRpb24nKSA6IHNlYXJjaERhdGEuc3RyaXBIVE1MKG9uRGF0YS5TKTtcbiAgICAgICAgICAgICAgICAgICAgdG1wVXJsID0gb25EYXRhLlU7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3RtcEljb249JyArIHRtcEljb24pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0T25lRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd0aXRsZSc6IHRtcFRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2MnOiB0bXBEZXNjcmlwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHRtcFVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdpY29uJzogdG1wSWNvblxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ29udGFpbmVyLmFwcGVuZCh0bXBsKCdzZWFyY2gtcmVzdWx0LXRtcCcsIHJlc3VsdE9uZURhdGEpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNhbGxiYWNrKHRvdGFsQ291bnQpO1xuXG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBzZWFyY2hEYXRhO1xufSgpKTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHNlYXJjaERhdGEuaW5pdCgpO1xufSk7XG4iXX0=
