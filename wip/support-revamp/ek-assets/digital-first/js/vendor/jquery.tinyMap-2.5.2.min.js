!function(o,t,i,n){function e(o,i){try{return t.hasOwnProperty?o.hasOwnProperty(i.toString()):Object.prototype.hasOwnProperty.call(o,i.toString())}catch(o){}}function s(t){var i=t.css||"";this.setValues(t),this.span=o("<span/>").css({position:"relative",left:"-50%",top:"0","white-space":"nowrap"}).addClass(i),this.div=o("<div/>").css({position:"absolute",display:"none"}),this.span.appendTo(this.div)}function r(i,n){e(t,"google")&&(this.map=null,this.container=i,this.options=o.extend({},a,n),this.interval=parseInt(this.options.interval,10),this.interval=isNaN(this.interval)?200:this.interval,this.GoogleMapOptions={center:new google.maps.LatLng(this.options.center.x,this.options.center.y),control:this.options.control,disableDefaultUI:this.options.disableDefaultUI,draggable:this.options.draggable,keyboardShortcuts:this.options.keyboardShortcuts,mapTypeId:google.maps.MapTypeId[this.options.mapTypeId.toUpperCase()],mapTypeControl:this.options.mapTypeControl,mapTypeControlOptions:{position:google.maps.ControlPosition[this.options.mapTypeControlOptions.position],style:google.maps.MapTypeControlStyle[this.options.mapTypeControlOptions.style.toUpperCase()]},maxZoom:this.options.maxZoom,minZoom:this.options.minZoom,navigationControl:this.options.navigationControl,navigationControlOptions:{position:google.maps.ControlPosition[this.options.navigationControlOptions.position],style:google.maps.NavigationControlStyle[this.options.navigationControlOptions.style.toUpperCase()]},panControl:this.options.panControl,panControlOptions:{position:google.maps.ControlPosition[this.options.panControlOptions.position]},rotateControl:this.options.rotateControl,scaleControl:this.options.scaleControl,scaleControlOptions:{position:google.maps.ControlPosition[this.options.scaleControlOptions.position],style:google.maps.ScaleControlStyle[this.options.scaleControlOptions.style.toUpperCase()]},scrollwheel:this.options.scrollwheel,streetViewControl:this.options.streetViewControl,streetViewControlOptions:{position:google.maps.ControlPosition[this.options.streetViewControlOptions.position]},zoom:this.options.zoom,zoomControl:this.options.zoomControl,zoomControlOptions:{position:google.maps.ControlPosition[this.options.zoomControlOptions.position],style:google.maps.ZoomControlStyle[this.options.zoomControlOptions.style.toUpperCase()]}},this.init())}var l=0,a={center:{x:"24",y:"121"},control:!0,disableDefaultUI:!1,draggable:!0,keyboardShortcuts:!0,mapTypeControl:!0,mapTypeControlOptions:{position:"TOP_RIGHT",style:"DEFAULT"},mapTypeId:"ROADMAP",marker:[],markerFitBounds:!1,maxZoom:null,minZoom:null,panControl:!0,panControlOptions:{position:"LEFT_TOP"},polyline:[],navigationControl:!0,navigationControlOptions:{position:"TOP_LEFT",style:"DEFAULT"},scaleControl:!0,scaleControlOptions:{position:"BOTTOM_LEFT",style:"DEFAULT"},scrollwheel:!0,streetViewControl:!0,streetViewControlOptions:{position:"LEFT_TOP"},zoom:4,zoomControl:!0,zoomControlOptions:{style:"LARGE",position:"LEFT_TOP"},notfound:"找不到查詢的地點",loading:"讀取中…",kml:{url:"",viewport:!0,infowindow:!1},interval:200};s.prototype=new google.maps.OverlayView,s.prototype.onAdd=function(){var t=this.getPanes().overlayLayer;this.div.appendTo(o(t)),this.listeners=[google.maps.event.addListener(this,"visible_changed",this.onRemove)]},s.prototype.draw=function(){var o=this.getProjection().fromLatLngToDivPixel(this.get("position"));this.div.css({left:o.x+"px",top:o.y+"px",display:"block"}),this.text&&this.span.html(this.text.toString())},s.prototype.onRemove=function(){o(this.div).remove()},r.prototype={VERSION:"2.5.2",_markers:[],_labels:[],_polylines:[],_polygons:[],_circles:[],_kmls:[],_directions:[],bounds:new google.maps.LatLngBounds,setZoom:function(o,t){e(t,"zoom")&&o&&o.setZoom(t.zoom)},kml:function(t,i){i=i||this.options;var e,s;n!==i.kml&&(e={preserveViewport:!0,suppressInfoWindows:!1},s="string"==typeof i.kml&&0!==i.kml.length?i.kml:n!==i.kml.url?i.kml.url:"",e=new google.maps.KmlLayer(s,o.extend(e,i.kml)),this._kmls.push(e),e.setMap(t))},direction:function(o,t){var i;if(t=t||this.options,n!==t.direction&&0<t.direction.length)for(i in t.direction)e(t.direction,i)&&n!==t.direction[i]&&this.DirectionService(t.direction[i])},markers:function(o,t){var i;if(t=t||this.options,n!==t.marker&&0<t.marker.length)for(i in t.marker)e(t.marker,i)&&e(t.marker[i],"addr")&&("object"==typeof t.marker[i].addr?2===t.marker[i].addr.length&&this.MarkerDirect(t.marker[i]):this.MarkerByGeocoder(t.marker[i]))},DrawPolyline:function(o,t){var i,s,r=[];if(t=t||this.options,n!==t.polyline&&n!==t.polyline.coords){for(i in t.polyline.coords)e(t.polyline.coords,i)&&(s=t.polyline.coords,n!==s[i]&&r.push(new google.maps.LatLng(s[i][0],s[i][1])));i=new google.maps.Polyline({path:r,strokeColor:t.polyline.color||"#FF0000",strokeOpacity:1,strokeWeight:t.polyline.width||2}),this._polylines.push(i),i.setMap(o)}},DrawPolygon:function(t,i){var s,r,l=[];if(i=i||this.options,n!==i.polygon&&n!==i.polygon.coords){for(s in i.polygon.coords)e(i.polygon.coords,s)&&(r=i.polygon.coords,n!==r[s]&&l.push(new google.maps.LatLng(r[s][0],r[s][1])));s=new google.maps.Polygon({path:l,strokeColor:i.polygon.color||"#FF0000",strokeOpacity:1,strokeWeight:i.polygon.width||2,fillColor:i.polygon.fillcolor||"#CC0000",fillOpacity:.35}),this._polygons.push(s),s.setMap(this.map),o.isFunction(i.polygon.click)&&google.maps.event.addListener(s,"click",i.polygon.click)}},DrawCircle:function(t,i){var e,s;if(i=i||this.options,n!==i.circle&&0<i.circle.length)for(e=i.circle.length-1;0<=e;e-=1)s=i.circle[e],n!==s.center.x&&n!==s.center.y&&(s=new google.maps.Circle({strokeColor:s.color||"#FF0000",strokeOpacity:s.opacity||.8,strokeWeight:s.width||2,fillColor:s.fillcolor||"#FF0000",fillOpacity:s.fillopacity||.35,map:this.map,center:new google.maps.LatLng(s.center.x,s.center.y),radius:s.radius||10,zIndex:100}),this._circles.push(s),o.isFunction(i.circle[e].click)&&google.maps.event.addListener(s,"click",i.circle[e].click))},overlay:function(){this.kml(this.map),this.direction(this.map),this.markers(this.map),this.DrawPolyline(this.map),this.DrawPolygon(this.map),this.DrawCircle(this.map)},MarkerDirect:function(o){var t,i,r=this;i={map:this.map,position:new google.maps.LatLng(o.addr[0],o.addr[1]),title:o.text.replace(/<([^>]+)>/g,""),infoWindow:new google.maps.InfoWindow({content:o.text})},"string"==typeof o.icon&&(i.icon=o.icon),t=new google.maps.Marker(i),this._markers.push(t),e(t,"position")&&t.getPosition().lat()&&t.getPosition().lng()&&r.bounds.extend(i.position),i={map:this.map,css:n!==o.css?o.css:""},"string"==typeof o.label&&0!==o.label.length&&(i.text=o.label),o=new s(i),o.bindTo("position",t,"position"),o.bindTo("text",t,"position"),o.bindTo("visible",t),google.maps.event.addListener(t,"click",function(){t.infoWindow.open(r.map,t)})},MarkerByGeocoder:function(o){var i=this;(new google.maps.Geocoder).geocode({address:o.addr},function(n,r){if(r===google.maps.GeocoderStatus.OVER_QUERY_LIMIT)t.setTimeout(function(){i.MarkerByGeocoder(o)},this.interval);else if(r===google.maps.GeocoderStatus.OK){var l,a;a={map:i.map,position:n[0].geometry.location,title:o.text.replace(/<([^>]+)>/g,""),infoWindow:new google.maps.InfoWindow({content:o.text})},"string"==typeof o.icon&&(a.icon=o.icon),l=new google.maps.Marker(a),i._markers.push(l),e(l,"position")&&l.getPosition().lat()&&l.getPosition().lng()&&i.bounds.extend(a.position),a={map:i.map,css:o.css||""},"string"==typeof o.label&&0!==o.label.length&&(a.text=o.label),a=new s(a),a.bindTo("position",l,"position"),a.bindTo("text",l,"position"),a.bindTo("visible",l),google.maps.event.addListener(l,"click",function(){l.infoWindow.open(i.map,l)})}})},DirectionService:function(o){var t=[],i=new google.maps.DirectionsService,e=new google.maps.DirectionsRenderer,s={travelMode:google.maps.DirectionsTravelMode.DRIVING,optimizeWaypoints:o.optimize||!1},r=0,l=0;if("string"==typeof o.from&&(s.origin=o.from),"string"==typeof o.to&&(s.destination=o.to),"string"==typeof o.travel&&0<o.travel.length&&(s.travelMode=google.maps.DirectionsTravelMode[o.travel.toUpperCase()]),n!==o.waypoint&&0!==o.waypoint){for(r=0,l=o.waypoint.length;r<l;r+=1)t.push({location:o.waypoint[r].toString(),stopover:!0});s.waypoints=t}n!==s.origin&&n!==s.destination&&(i.route(s,function(o,t){t===google.maps.DirectionsStatus.OK&&e.setDirections(o)}),e.setMap(this.map),this._directions.push(e))},init:function(){var i,e=this;l+=1,"string"==typeof this.options.center?t.setTimeout(function(){i=new google.maps.Geocoder,error=o(e.container),msg="",i.geocode({address:e.options.center},function(o,t){try{t===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?e.init():t===google.maps.GeocoderStatus.OK&&0!==o.length?(e.GoogleMapOptions.center=t===google.maps.GeocoderStatus.OK&&0!==o.length?o[0].geometry.location:"",e.map=new google.maps.Map(e.container,e.GoogleMapOptions),e.overlay(),e.options.marker.length&&!0===e.options.markerFitBounds&&setTimeout(function(){e.map.fitBounds(e.bounds)},this.interval)):(msg=e.options.notfound.text||t,error.html(msg.replace(/</g,"&lt;").replace(/>/g,"&gt;")))}catch(o){error.html((n!==o.message?o.message:o.description).toString())}})},this.interval*l):(e.map=new google.maps.Map(e.container,e.GoogleMapOptions),e.overlay(),e.options.marker.length&&!0===e.options.markerFitBounds&&e.map.fitBounds(e.bounds))},panto:function(t){var i,s=this;e(s,"map")&&null!==s.map&&n!==s.map&&("string"==typeof t?(-1!==t.indexOf(",")&&(i="loc: "+t),i=new google.maps.Geocoder,i.geocode({address:t},function(t,i){i===google.maps.GeocoderStatus.OK&&o.isFunction(s.map.panTo)&&n!==t[0]&&s.map.panTo(t[0].geometry.location)})):("[object Array]"===Object.prototype.toString.call(t)?2===t.length&&(i=new google.maps.LatLng(t[0],t[1])):e(t,"lat")&&e(t,"lng")?i=new google.maps.LatLng(t.lat,t.lng):e(t,"x")&&e(t,"y")&&(i=new google.maps.LatLng(t.x,t.y)),o.isFunction(s.map.panTo)&&n!==i&&s.map.panTo(i)))},clear:function(t){var i,e,s;for("string"==typeof t&&(i=t.split(",")),e=0;e<i.length;e+=1)if(t="_"+o.trim(i[e].toString().toLowerCase())+"s",n!==this[t]&&this[t].length){for(s=0;s<this[t].length;s+=1)this[t][s].set("visible",!1),this[t][s].setMap(null);this[t]=[]}},modify:function(o){var t,i=[],s=[["kml","kml"],["marker","markers"],["direction","direction"],["polyline","DrawPolyline"],["polygon","DrawPolygon"],["circle","DrawCircle"],["zoom","setZoom"]];if(n!==o){for(t=0;t<s.length;t+=1)e(o,s[t][0])&&i.push(s[t][1]);if(null!==this.map&&n!==this.map&&i)for(t=0;t<i.length;t+=1)"function"==typeof this[i[t]]&&this[i[t]](this.map,o)}}},o.fn.tinyMap=function(t){var i,e,s=arguments;return"string"==typeof t?(this.each(function(){(e=o.data(this,"tinyMap"))instanceof r&&"function"==typeof e[t]&&(i=e[t].apply(e,Array.prototype.slice.call(s,1)))}),n!==i?i:this):this.each(function(){o.data(this,"tinyMap")||o.data(this,"tinyMap",new r(this,t))})}}(jQuery,window,document);