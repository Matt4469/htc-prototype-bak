var subPromo=function(){"use strict";var t={init:function(){t.itemClick()},itemClick:function(){var t=$(".subpromo .promo-item");t.length>0&&t.on("click",function(){var t=$(this).find("a").attr("href");location.href=t})}};return t}(),topicList=function(){"use strict";var t={init:function(){t.topicClick()},topicClick:function(){$(".topic-item").click(function(){$(this).hasClass("selected")||($(".topic-item").removeClass("selectes"),$(this).addClass("selected"))})}};return t}(),productList=function(){"use strict";var t,e,i={clsNameContainer:".listing-detailed-container"},o={init:function(){},itemsInRow:function(){var t=0;return $(".product-item").each(function(){if($(this).prev().length>0){if($(this).position().top!==$(this).prev().position().top)return!1;t++}else t++}),t},appendAfterItem:function(t){for(var e=o.itemsInRow(),i=1,n=e;n<$(".product-item").length;n+=e){if(t<n)return n-1;i+=1}},removeDetailItem:function(t){$(".detail-item").removeClass("active"),commonSetting.removeMobilePopupFix(),setTimeout(function(){$(".product-item").removeClass("selected"),$(".detail-item").remove(),t()},500)},removePopupItem:function(){$(".carrier-popup").removeClass("show"),$("body").removeClass("support-popup-fixed")},scrollToSubItem:function(t){var e=$(".flex-box-area").find(".detail-item"),o=new TimelineLite({immediateRender:!1}),n=$(i.clsNameContainer).offset().top-70;$("html, body").animate({scrollTop:n},500),o.add(TweenLite.set(e,{height:"auto"})),o.add(TweenLite.from(e,.5,{height:t}),"-=0.49"),o.call(function(){e.addClass("active")},[],this,"-=0.49"),o.play()},collapseCarrier:function(){var t=$(".flex-box-area").find(".detail-item"),e=new TimelineLite;e.add(TweenLite.to(t,.5,{height:0}),"+=0.4"),e.call(function(){t.removeClass("active")},[],this),e.play()},expandList:function(t){var e=$(".detail-item"),i=0;commonSetting.isMobile()||$(".flex-box-area").removeClass("add-padding"),e.length>0?(i=e.height(),e.css("height","auto").removeClass("active").html("")):e=$('<div class="detail-item"></div>'),$(".product-item").each(function(t,n){if($(this).hasClass("selected")){var a=t,r=o.appendAfterItem(a),c='<div class="related-product-group popup-window"><div class="btn-close"></div><div class="popup-title m-popup-title">'+$(".hidden-select-product-model").val()+"</div>"+$(this).find(".related-products").html()+"</div>";void 0===r?e.append(c).insertAfter($(".product-item").last()):e.append(c).insertAfter($(".product-item").eq(r)),commonSetting.isMobile()?(e.addClass("active"),commonSetting.addMobilePopupFix()):o.scrollToSubItem(i),o.closeBtnClick(),o.productClick()}})},familyClick:function(){$(".product-item").click(function(i){var n=$(this).data("url");void 0!==n&&n.length>0?location.href=n:$(this).hasClass("selected")||(e.val(""),t.val($(this).index()),o.pushParams())})},restoreFamilySelection:function(){$(".product-item").removeClass("selected"),$(".product-item").eq(t.val()).addClass("selected"),o.expandList(!0)},productClick:function(){$(".product-list-container .related-product-item").off("click").on("click",function(t){if(t.preventDefault(),$(this).find(".hidden-carrier-block").length>0)e.val($(this).index()),o.pushParams();else{var i;i=commonSetting.isPrototypeHost()?"product-landing.htm?pname_id="+$(this).data("pname-id"):$(this).attr("href"),location.href=i}})},restoreProductSelection:function(){var t=$(".detail-item .related-product-item").eq(e.val()).find(".hidden-carrier-block").html();$(".carrier-popup").find(".popup-list").html(t),o.openPopupWindow(),o.closePopupWindowClick()},openPopupWindow:function(){$(".carrier-popup").addClass("show"),o.carrierPopupListClick(),$("body").addClass("support-popup-fixed")},closePopupWindowClick:function(){$(".carrier-popup").find(".btn-close").click(function(){e.val(""),commonSetting.isMobile()&&t.val(""),o.pushParams()})},carrierPopupListClick:function(){$(".carrier-popup").find(".popup-list > li").click(function(){location.href=$(this).data("url")})},closeBtnClick:function(){$(".detail-item").find(".btn-close").click(function(){o.collapseCarrier(),e.val(""),t.val(""),o.pushParams()})},initObj:function(){t=$(".hidden-seleted-family"),e=$(".hidden-seleted-product")},updateHiddenInput:function(i){var n=$.url(),a=n.param("family"),r=n.param("product");o.initObj(),t.val(""),e.val(""),void 0!==a&&(t.val(a),void 0!==r&&e.val(r)),i()},pushParams:function(){var i=t.val(),o=e.val(),n="";void 0!==i&&i.length>0&&(n+="&family="+i),void 0!==o&&o.length>0&&(n+="&product="+o),History.pushState({rand:Math.random(),family:i,product:o},document.title,"?"+n)},restorePageStatus:function(){o.familyClick(),""!==t.val()?(o.restoreFamilySelection(),""!==e.val()&&o.restoreProductSelection()):commonSetting.isMobile()||$(".flex-box-area").addClass("add-padding")},setupClickStatus:function(){o.familyClick(),""!==e.val()?o.restoreProductSelection():(o.removePopupItem(),""!==t.val()?o.restoreFamilySelection():o.removeDetailItem(function(){commonSetting.isMobile()||$(".flex-box-area").addClass("add-padding")}))}};return o}();$(document).ready(function(){"use strict";topicList.init(),subPromo.init()}),$(window).resize(function(t){"use strict";commonSetting.forcePageReload()}),function(t,e){"use strict";"file:"===document.location.protocol&&alert("The HTML5 History API (and thus History.js) do not work on files, please upload it to a server."),productList.updateHiddenInput(function(){productList.restorePageStatus()}),History.Adapter.bind(t,"statechange",function(){History.getState();productList.updateHiddenInput(function(){productList.setupClickStatus()})})}(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlZmF1bHQuanMiXSwibmFtZXMiOlsic3ViUHJvbW8iLCJpbml0IiwiaXRlbUNsaWNrIiwicHJvbW9JdG1lcyIsIiQiLCJsZW5ndGgiLCJvbiIsInVybExpbmsiLCJ0aGlzIiwiZmluZCIsImF0dHIiLCJsb2NhdGlvbiIsImhyZWYiLCJ0b3BpY0xpc3QiLCJ0b3BpY0NsaWNrIiwiY2xpY2siLCJoYXNDbGFzcyIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJwcm9kdWN0TGlzdCIsIl9oaWRkZW5GYW1pbHkiLCJfaGlkZGVuUHJvZHVjdCIsInNldHRpbmciLCJjbHNOYW1lQ29udGFpbmVyIiwiaXRlbXNJblJvdyIsImxpc0luUm93IiwiZWFjaCIsInByZXYiLCJwb3NpdGlvbiIsInRvcCIsImFwcGVuZEFmdGVySXRlbSIsImlkeCIsIml0ZW1zRXZlcnlSb3ciLCJyZXN1bHRSb3ciLCJpIiwicmVtb3ZlRGV0YWlsSXRlbSIsImNhbGxiYWNrIiwiY29tbW9uU2V0dGluZyIsInJlbW92ZU1vYmlsZVBvcHVwRml4Iiwic2V0VGltZW91dCIsInJlbW92ZSIsInJlbW92ZVBvcHVwSXRlbSIsInNjcm9sbFRvU3ViSXRlbSIsImRldGFpbEl0ZW1IZWlnaHQiLCIkY2FycmllciIsInRpbWVMaW5lT2JqIiwiVGltZWxpbmVMaXRlIiwiaW1tZWRpYXRlUmVuZGVyIiwic2Nyb2xsSGVpZ2h0UG9zaXRpb24iLCJvZmZzZXQiLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiYWRkIiwiVHdlZW5MaXRlIiwic2V0IiwiaGVpZ2h0IiwiZnJvbSIsImNhbGwiLCJwbGF5IiwiY29sbGFwc2VDYXJyaWVyIiwidG8iLCJleHBhbmRMaXN0Iiwic2xpZGVBbmltYXRpb24iLCJkZXRhaWxJdGVtc0NvbnRhaW5lciIsImlzTW9iaWxlIiwiY3NzIiwiaHRtbCIsImluZGV4IiwiZWwiLCJjdXJyZW50SW5kZXgiLCJhcHBlbmRJdGVtSW5kZXgiLCJhcHBlbmRIdG1sIiwidmFsIiwiYXBwZW5kIiwiaW5zZXJ0QWZ0ZXIiLCJsYXN0IiwiZXEiLCJhZGRNb2JpbGVQb3B1cEZpeCIsImNsb3NlQnRuQ2xpY2siLCJwcm9kdWN0Q2xpY2siLCJmYW1pbHlDbGljayIsImV2ZW50Iiwib3V0c2lkZUxpbmsiLCJkYXRhIiwicHVzaFBhcmFtcyIsInJlc3RvcmVGYW1pbHlTZWxlY3Rpb24iLCJvZmYiLCJwcmV2ZW50RGVmYXVsdCIsIm5ld1VybCIsImlzUHJvdG90eXBlSG9zdCIsInJlc3RvcmVQcm9kdWN0U2VsZWN0aW9uIiwiY2Fycmllckxpc3RIdG1sIiwib3BlblBvcHVwV2luZG93IiwiY2xvc2VQb3B1cFdpbmRvd0NsaWNrIiwiY2FycmllclBvcHVwTGlzdENsaWNrIiwiaW5pdE9iaiIsInVwZGF0ZUhpZGRlbklucHV0IiwidXJsIiwicGFyYW1GYW1pbHkiLCJwYXJhbSIsInBhcmFtUHJvZHVjdCIsInNlbGVjdGVkRmFtaWx5Iiwic2VsZWN0ZWRQcm9kdWN0IiwidXJsUGF0aCIsIkhpc3RvcnkiLCJwdXNoU3RhdGUiLCJyYW5kIiwiTWF0aCIsInJhbmRvbSIsImZhbWlseSIsInByb2R1Y3QiLCJkb2N1bWVudCIsInRpdGxlIiwicmVzdG9yZVBhZ2VTdGF0dXMiLCJzZXR1cENsaWNrU3RhdHVzIiwicmVhZHkiLCJ3aW5kb3ciLCJyZXNpemUiLCJmb3JjZVBhZ2VSZWxvYWQiLCJ1bmRlZmluZWQiLCJwcm90b2NvbCIsImFsZXJ0IiwiQWRhcHRlciIsImJpbmQiLCJnZXRTdGF0ZSJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsVUFBWSxXQUNaLFlBQ0EsSUFBSUEsSUFDQUMsS0FBTSxXQUNGRCxFQUFTRSxhQUViQSxVQUFXLFdBQ1AsR0FBSUMsR0FBYUMsRUFBRSx3QkFDZkQsR0FBV0UsT0FBUyxHQUNwQkYsRUFBV0csR0FBRyxRQUFTLFdBQ25CLEdBQUlDLEdBQVVILEVBQUVJLE1BQU1DLEtBQUssS0FBS0MsS0FBSyxPQUNyQ0MsVUFBU0MsS0FBT0wsS0FLaEMsT0FBT1AsTUFFUGEsVUFBYSxXQUNiLFlBQ0Es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QyxNQUFPLElBQU1ULElBRTdCVSxrQkFBbUIsV0FDZjlGLEVBQVk2RCxjQUNnQixLQUF4QjVELEVBQWNvRCxPQUNkckQsRUFBWWtFLHlCQUNpQixLQUF6QmhFLEVBQWVtRCxPQUNmckQsRUFBWXVFLDJCQUdYckQsY0FBYzJCLFlBQ2Y1RCxFQUFFLGtCQUFrQmMsU0FBUyxnQkFJekNnRyxpQkFBa0IsV0FDZC9GLEVBQVk2RCxjQUNpQixLQUF6QjNELEVBQWVtRCxNQUNmckQsRUFBWXVFLDJCQUVadkUsRUFBWXNCLGtCQUNnQixLQUF4QnJCLEVBQWNvRCxNQUNkckQsRUFBWWtFLHlCQUVabEUsRUFBWWdCLGlCQUFpQixXQUNwQkUsY0FBYzJCLFlBQ2Y1RCxFQUFFLGtCQUFrQmMsU0FBUyxtQkFPckQsT0FBT0MsS0FFWGYsR0FBRTJHLFVBQVVJLE1BQU0sV0FDZCxZQUNBdEcsV0FBVVosT0FDVkQsU0FBU0MsU0FFYkcsRUFBRWdILFFBQVFDLE9BQU8sU0FBU3BDLEdBQ3RCLFlBQ0E1QyxlQUFjaUYsb0JBRWxCLFNBQVVGLEVBQVFHLEdBQ2QsWUFFbUMsV0FBL0JSLFNBQVNwRyxTQUFTNkcsVUFDbEJDLE1BQU0sbUdBRVZ0RyxZQUFZNkUsa0JBQWtCLFdBQzFCN0UsWUFBWThGLHNCQUVoQlQsUUFBUWtCLFFBQVFDLEtBQUtQLEVBQVEsY0FBZSxXQUM1QlosUUFBUW9CLFVBQ3BCekcsYUFBWTZFLGtCQUFrQixXQUMxQjdFLFlBQVkrRix3QkFJckJFIiwiZmlsZSI6ImRlZmF1bHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBjb21tb25TZXR0aW5nLCBIaXN0b3J5LCBUd2VlbkxpdGUsIFRpbWVsaW5lTGl0ZSovXG52YXIgc3ViUHJvbW8gPSAoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBzdWJQcm9tbyA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdWJQcm9tby5pdGVtQ2xpY2soKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXRlbUNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBwcm9tb0l0bWVzID0gJCgnLnN1YnByb21vIC5wcm9tby1pdGVtJyk7XG4gICAgICAgICAgICBpZiAocHJvbW9JdG1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcHJvbW9JdG1lcy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVybExpbmsgPSAkKHRoaXMpLmZpbmQoJ2EnKS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSB1cmxMaW5rO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gc3ViUHJvbW87XG59KCkpO1xudmFyIHRvcGljTGlzdCA9IChmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHRvcGljTGlzdCA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0b3BpY0xpc3QudG9waWNDbGljaygpO1xuICAgICAgICB9LFxuICAgICAgICB0b3BpY0NsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy50b3BpYy1pdGVtJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy50b3BpYy1pdGVtJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVzJyk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiB0b3BpY0xpc3Q7XG59KCkpO1xudmFyIHByb2R1Y3RMaXN0ID0gKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgX2hpZGRlbkZhbWlseSxcbiAgICAgICAgX2hpZGRlblByb2R1Y3QsXG4gICAgICAgIHNldHRpbmcgPSB7XG4gICAgICAgICAgICAnY2xzTmFtZUNvbnRhaW5lcic6ICcubGlzdGluZy1kZXRhaWxlZC1jb250YWluZXInXG4gICAgICAgIH07XG4gICAgdmFyIHByb2R1Y3RMaXN0ID0ge1xuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHt9LFxuICAgICAgICBpdGVtc0luUm93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBsaXNJblJvdyA9IDA7XG4gICAgICAgICAgICAkKCcucHJvZHVjdC1pdGVtJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5wcmV2KCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5wb3NpdGlvbigpLnRvcCAhPT0gJCh0aGlzKS5wcmV2KCkucG9zaXRpb24oKS50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsaXNJblJvdysrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc0luUm93Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbGlzSW5Sb3c7XG4gICAgICAgIH0sXG4gICAgICAgIGFwcGVuZEFmdGVySXRlbTogZnVuY3Rpb24oaWR4KSB7XG4gICAgICAgICAgICB2YXIgaXRlbXNFdmVyeVJvdyA9IHByb2R1Y3RMaXN0Lml0ZW1zSW5Sb3coKSxcbiAgICAgICAgICAgICAgICByZXN1bHRSb3cgPSAxO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGl0ZW1zRXZlcnlSb3c7IGkgPCAkKCcucHJvZHVjdC1pdGVtJykubGVuZ3RoOyBpICs9IGl0ZW1zRXZlcnlSb3cpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnaWR4PScgKyBpZHggKyBcIiA8IGk9XCIgKyBpKTtcbiAgICAgICAgICAgICAgICBpZiAoaWR4IDwgaSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSAtIDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Um93ICs9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZW1vdmVEZXRhaWxJdGVtOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgJCgnLmRldGFpbC1pdGVtJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgY29tbW9uU2V0dGluZy5yZW1vdmVNb2JpbGVQb3B1cEZpeCgpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcucHJvZHVjdC1pdGVtJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgJCgnLmRldGFpbC1pdGVtJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlbW92ZVBvcHVwSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuY2Fycmllci1wb3B1cCcpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3N1cHBvcnQtcG9wdXAtZml4ZWQnKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2Nyb2xsVG9TdWJJdGVtOiBmdW5jdGlvbihkZXRhaWxJdGVtSGVpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVySGVpZ2h0ID0gNzAsXG4gICAgICAgICAgICAgICAgJGNhcnJpZXIgPSAkKCcuZmxleC1ib3gtYXJlYScpLmZpbmQoJy5kZXRhaWwtaXRlbScpLFxuICAgICAgICAgICAgICAgIHRpbWVMaW5lT2JqID0gbmV3IFRpbWVsaW5lTGl0ZSh7aW1tZWRpYXRlUmVuZGVyOiBmYWxzZX0pO1xuXG4gICAgICAgICAgICAvL3Njcm9sbCB0byBmYW1pbHkgc2VjdGlvblxuICAgICAgICAgICAgLy8gdGltZUxpbmVPYmouYWRkKFR3ZWVuTGl0ZS50byh3aW5kb3csIDAuNSwge1xuICAgICAgICAgICAgLy8gICAgIHNjcm9sbFRvOiB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHk6IHNldHRpbmcuY2xzTmFtZUNvbnRhaW5lcixcbiAgICAgICAgICAgIC8vICAgICAgICAgb2Zmc2V0WTogaGVhZGVySGVpZ2h0XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvL3VzZSBqcXVlcnkgYW5pbWF0aW9uXG4gICAgICAgICAgICB2YXIgc2Nyb2xsSGVpZ2h0UG9zaXRpb24gPSAkKHNldHRpbmcuY2xzTmFtZUNvbnRhaW5lcikub2Zmc2V0KCkudG9wIC0gaGVhZGVySGVpZ2h0O1xuICAgICAgICAgICAgICQoXCJodG1sLCBib2R5XCIpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IHNjcm9sbEhlaWdodFBvc2l0aW9uIH0sIDUwMCk7XG4gICAgICAgICAgICAvL2V4cGFuZCBwcm9kdWN0IGRldGFpbCBsaXN0XG4gICAgICAgICAgICB0aW1lTGluZU9iai5hZGQoVHdlZW5MaXRlLnNldCgkY2Fycmllciwge1xuICAgICAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB0aW1lTGluZU9iai5hZGQoVHdlZW5MaXRlLmZyb20oJGNhcnJpZXIsIDAuNSwge1xuICAgICAgICAgICAgICAgIGhlaWdodDogZGV0YWlsSXRlbUhlaWdodFxuICAgICAgICAgICAgfSksICctPTAuNDknKTtcbiAgICAgICAgICAgIC8vc2hvdyBwcm9kdWN0IGl0ZW1zXG4gICAgICAgICAgICB0aW1lTGluZU9iai5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRjYXJyaWVyLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH0sIFtdLCB0aGlzLCAnLT0wLjQ5Jyk7XG4gICAgICAgICAgICAvL3N0YXJ0IFxuICAgICAgICAgICAgdGltZUxpbmVPYmoucGxheSgpO1xuICAgICAgICB9LFxuICAgICAgICBjb2xsYXBzZUNhcnJpZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRjYXJyaWVyID0gJCgnLmZsZXgtYm94LWFyZWEnKS5maW5kKCcuZGV0YWlsLWl0ZW0nKSxcbiAgICAgICAgICAgICAgICB0aW1lTGluZU9iaiA9IG5ldyBUaW1lbGluZUxpdGUoKTtcbiAgICAgICAgICAgIC8vZXhwYW5kIHByb2R1Y3QgZGV0YWlsIGxpc3RcbiAgICAgICAgICAgIHRpbWVMaW5lT2JqLmFkZChUd2VlbkxpdGUudG8oJGNhcnJpZXIsIDAuNSwge1xuICAgICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgfSksICcrPTAuNCcpO1xuICAgICAgICAgICAgLy9zaG93IHByb2R1Y3QgaXRlbXNcbiAgICAgICAgICAgIHRpbWVMaW5lT2JqLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJGNhcnJpZXIucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSwgW10sIHRoaXMpO1xuICAgICAgICAgICAgLy9zdGFydCBcbiAgICAgICAgICAgIHRpbWVMaW5lT2JqLnBsYXkoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXhwYW5kTGlzdDogZnVuY3Rpb24oc2xpZGVBbmltYXRpb24pIHtcbiAgICAgICAgICAgIHZhciBkZXRhaWxJdGVtc0NvbnRhaW5lciA9ICQoJy5kZXRhaWwtaXRlbScpLFxuICAgICAgICAgICAgICAgIGRldGFpbEl0ZW1IZWlnaHQgPSAwO1xuICAgICAgICAgICAgaWYgKCFjb21tb25TZXR0aW5nLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgICAgICAgICAkKCcuZmxleC1ib3gtYXJlYScpLnJlbW92ZUNsYXNzKCdhZGQtcGFkZGluZycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRldGFpbEl0ZW1zQ29udGFpbmVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBkZXRhaWxJdGVtSGVpZ2h0ID0gZGV0YWlsSXRlbXNDb250YWluZXIuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgZGV0YWlsSXRlbXNDb250YWluZXIuY3NzKCdoZWlnaHQnLCAnYXV0bycpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKS5odG1sKCcnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGV0YWlsSXRlbXNDb250YWluZXIgPSAkKCc8ZGl2IGNsYXNzPVwiZGV0YWlsLWl0ZW1cIj48L2Rpdj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoJy5wcm9kdWN0LWl0ZW0nKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbCkge1xuICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGUgdGhyb3VnaCBhcnJheSBvciBvYmplY3QgKi9cbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnc2VsZWN0ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRJdGVtSW5kZXggPSBwcm9kdWN0TGlzdC5hcHBlbmRBZnRlckl0ZW0oY3VycmVudEluZGV4KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZEh0bWwgPSAnPGRpdiBjbGFzcz1cInJlbGF0ZWQtcHJvZHVjdC1ncm91cCBwb3B1cC13aW5kb3dcIj48ZGl2IGNsYXNzPVwiYnRuLWNsb3NlXCI+PC9kaXY+PGRpdiBjbGFzcz1cInBvcHVwLXRpdGxlIG0tcG9wdXAtdGl0bGVcIj4nICsgJCgnLmhpZGRlbi1zZWxlY3QtcHJvZHVjdC1tb2RlbCcpLnZhbCgpICsgJzwvZGl2PicgKyAkKHRoaXMpLmZpbmQoJy5yZWxhdGVkLXByb2R1Y3RzJykuaHRtbCgpICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXBwZW5kSXRlbUluZGV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsSXRlbXNDb250YWluZXIuYXBwZW5kKGFwcGVuZEh0bWwpLmluc2VydEFmdGVyKCQoJy5wcm9kdWN0LWl0ZW0nKS5sYXN0KCkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsSXRlbXNDb250YWluZXIuYXBwZW5kKGFwcGVuZEh0bWwpLmluc2VydEFmdGVyKCQoJy5wcm9kdWN0LWl0ZW0nKS5lcShhcHBlbmRJdGVtSW5kZXgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29tbW9uU2V0dGluZy5pc01vYmlsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxJdGVtc0NvbnRhaW5lci5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tb25TZXR0aW5nLmFkZE1vYmlsZVBvcHVwRml4KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5zY3JvbGxUb1N1Ykl0ZW0oZGV0YWlsSXRlbUhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdExpc3QuY2xvc2VCdG5DbGljaygpO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5wcm9kdWN0Q2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZmFtaWx5Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLnByb2R1Y3QtaXRlbScpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgLyogQWN0IG9uIHRoZSBldmVudCAqL1xuICAgICAgICAgICAgICAgIHZhciBvdXRzaWRlTGluayA9ICQodGhpcykuZGF0YSgndXJsJyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvdXRzaWRlTGluayAhPT0gJ3VuZGVmaW5lZCcgJiYgb3V0c2lkZUxpbmsubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gb3V0c2lkZUxpbms7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZGVuUHJvZHVjdC52YWwoJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGRlbkZhbWlseS52YWwoJCh0aGlzKS5pbmRleCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RMaXN0LnB1c2hQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICByZXN0b3JlRmFtaWx5U2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5wcm9kdWN0LWl0ZW0nKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICQoJy5wcm9kdWN0LWl0ZW0nKS5lcShfaGlkZGVuRmFtaWx5LnZhbCgpKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIHByb2R1Y3RMaXN0LmV4cGFuZExpc3QodHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHByb2R1Y3RDbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcucHJvZHVjdC1saXN0LWNvbnRhaW5lciAucmVsYXRlZC1wcm9kdWN0LWl0ZW0nKS5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHZhciBjYXJyaWVyTGlzdCA9ICQodGhpcykuZmluZCgnLmhpZGRlbi1jYXJyaWVyLWJsb2NrJyk7XG4gICAgICAgICAgICAgICAgaWYgKGNhcnJpZXJMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9zaG93IHBvcHVwXG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5Qcm9kdWN0LnZhbCgkKHRoaXMpLmluZGV4KCkpO1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5wdXNoUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9wYWdlIHJlZGlyZWN0XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdVcmw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb21tb25TZXR0aW5nLmlzUHJvdG90eXBlSG9zdCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdVcmwgPSAncHJvZHVjdC1sYW5kaW5nLmh0bT9wbmFtZV9pZD0nICsgJCh0aGlzKS5kYXRhKCdwbmFtZS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IG5ld1VybDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzdG9yZVByb2R1Y3RTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNhcnJpZXJMaXN0SHRtbCA9ICQoJy5kZXRhaWwtaXRlbSAucmVsYXRlZC1wcm9kdWN0LWl0ZW0nKS5lcShfaGlkZGVuUHJvZHVjdC52YWwoKSkuZmluZCgnLmhpZGRlbi1jYXJyaWVyLWJsb2NrJykuaHRtbCgpO1xuICAgICAgICAgICAgJCgnLmNhcnJpZXItcG9wdXAnKS5maW5kKCcucG9wdXAtbGlzdCcpLmh0bWwoY2Fycmllckxpc3RIdG1sKTtcbiAgICAgICAgICAgIHByb2R1Y3RMaXN0Lm9wZW5Qb3B1cFdpbmRvdygpO1xuICAgICAgICAgICAgcHJvZHVjdExpc3QuY2xvc2VQb3B1cFdpbmRvd0NsaWNrKCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW5Qb3B1cFdpbmRvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcuY2Fycmllci1wb3B1cCcpLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICBwcm9kdWN0TGlzdC5jYXJyaWVyUG9wdXBMaXN0Q2xpY2soKTtcbiAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnc3VwcG9ydC1wb3B1cC1maXhlZCcpO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZVBvcHVwV2luZG93Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLmNhcnJpZXItcG9wdXAnKS5maW5kKCcuYnRuLWNsb3NlJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX2hpZGRlblByb2R1Y3QudmFsKCcnKTtcbiAgICAgICAgICAgICAgICBpZiAoY29tbW9uU2V0dGluZy5pc01vYmlsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5GYW1pbHkudmFsKCcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvZHVjdExpc3QucHVzaFBhcmFtcygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNhcnJpZXJQb3B1cExpc3RDbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAnJztcbiAgICAgICAgICAgICQoJy5jYXJyaWVyLXBvcHVwJykuZmluZCgnLnBvcHVwLWxpc3QgPiBsaScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmRhdGEoJ3VybCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNsb3NlQnRuQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLmRldGFpbC1pdGVtJykuZmluZCgnLmJ0bi1jbG9zZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByb2R1Y3RMaXN0LmNvbGxhcHNlQ2FycmllcigpO1xuICAgICAgICAgICAgICAgIF9oaWRkZW5Qcm9kdWN0LnZhbCgnJyk7XG4gICAgICAgICAgICAgICAgX2hpZGRlbkZhbWlseS52YWwoJycpO1xuICAgICAgICAgICAgICAgIHByb2R1Y3RMaXN0LnB1c2hQYXJhbXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvL3N0YXRlVVBkYXRlXG4gICAgICAgIGluaXRPYmo6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX2hpZGRlbkZhbWlseSA9ICQoJy5oaWRkZW4tc2VsZXRlZC1mYW1pbHknKTtcbiAgICAgICAgICAgIF9oaWRkZW5Qcm9kdWN0ID0gJCgnLmhpZGRlbi1zZWxldGVkLXByb2R1Y3QnKTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlSGlkZGVuSW5wdXQ6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gJC51cmwoKSxcbiAgICAgICAgICAgICAgICBwYXJhbUZhbWlseSA9IHVybC5wYXJhbSgnZmFtaWx5JyksXG4gICAgICAgICAgICAgICAgcGFyYW1Qcm9kdWN0ID0gdXJsLnBhcmFtKCdwcm9kdWN0Jyk7XG4gICAgICAgICAgICBwcm9kdWN0TGlzdC5pbml0T2JqKCk7XG4gICAgICAgICAgICBfaGlkZGVuRmFtaWx5LnZhbCgnJyk7XG4gICAgICAgICAgICBfaGlkZGVuUHJvZHVjdC52YWwoJycpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbUZhbWlseSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBfaGlkZGVuRmFtaWx5LnZhbChwYXJhbUZhbWlseSk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbVByb2R1Y3QgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRkZW5Qcm9kdWN0LnZhbChwYXJhbVByb2R1Y3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdXBkYXRlIGhpZGRlbiBpcHV0cyBhbmQgdGhlblxuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSxcbiAgICAgICAgcHVzaFBhcmFtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRGYW1pbHkgPSBfaGlkZGVuRmFtaWx5LnZhbCgpLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkUHJvZHVjdCA9IF9oaWRkZW5Qcm9kdWN0LnZhbCgpLFxuICAgICAgICAgICAgICAgIHVybFBhdGggPSAnJztcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWxlY3RlZEZhbWlseS5sZW5ndGg9JyArIHNlbGVjdGVkRmFtaWx5Lmxlbmd0aCk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2VsZWN0ZWRGYW1pbHk9JyArIHNlbGVjdGVkRmFtaWx5ICsgJ3x8c2VsZWN0ZWRQcm9kdWN0PScgKyBzZWxlY3RlZFByb2R1Y3QpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RlZEZhbWlseSAhPT0gJ3VuZGVmaW5lZCcgJiYgc2VsZWN0ZWRGYW1pbHkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHVybFBhdGggKz0gJyZmYW1pbHk9JyArIHNlbGVjdGVkRmFtaWx5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RlZFByb2R1Y3QgIT09ICd1bmRlZmluZWQnICYmIHNlbGVjdGVkUHJvZHVjdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdXJsUGF0aCArPSAnJnByb2R1Y3Q9JyArIHNlbGVjdGVkUHJvZHVjdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKHtcbiAgICAgICAgICAgICAgICByYW5kOiBNYXRoLnJhbmRvbSgpLFxuICAgICAgICAgICAgICAgIGZhbWlseTogc2VsZWN0ZWRGYW1pbHksXG4gICAgICAgICAgICAgICAgcHJvZHVjdDogc2VsZWN0ZWRQcm9kdWN0XG4gICAgICAgICAgICB9LCBkb2N1bWVudC50aXRsZSwgJz8nICsgdXJsUGF0aCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3RvcmVQYWdlU3RhdHVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHByb2R1Y3RMaXN0LmZhbWlseUNsaWNrKCk7XG4gICAgICAgICAgICBpZiAoX2hpZGRlbkZhbWlseS52YWwoKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5yZXN0b3JlRmFtaWx5U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKF9oaWRkZW5Qcm9kdWN0LnZhbCgpICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5yZXN0b3JlUHJvZHVjdFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjb21tb25TZXR0aW5nLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmZsZXgtYm94LWFyZWEnKS5hZGRDbGFzcygnYWRkLXBhZGRpbmcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldHVwQ2xpY2tTdGF0dXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcHJvZHVjdExpc3QuZmFtaWx5Q2xpY2soKTtcbiAgICAgICAgICAgIGlmIChfaGlkZGVuUHJvZHVjdC52YWwoKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5yZXN0b3JlUHJvZHVjdFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0TGlzdC5yZW1vdmVQb3B1cEl0ZW0oKTtcbiAgICAgICAgICAgICAgICBpZiAoX2hpZGRlbkZhbWlseS52YWwoKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdExpc3QucmVzdG9yZUZhbWlseVNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RMaXN0LnJlbW92ZURldGFpbEl0ZW0oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbW1vblNldHRpbmcuaXNNb2JpbGUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5mbGV4LWJveC1hcmVhJykuYWRkQ2xhc3MoJ2FkZC1wYWRkaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIHByb2R1Y3RMaXN0O1xufSgpKTtcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB0b3BpY0xpc3QuaW5pdCgpO1xuICAgIHN1YlByb21vLmluaXQoKTtcbn0pO1xuJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbihldmVudCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBjb21tb25TZXR0aW5nLmZvcmNlUGFnZVJlbG9hZCgpO1xufSk7XG4oZnVuY3Rpb24od2luZG93LCB1bmRlZmluZWQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy8gQ2hlY2sgTG9jYXRpb25cbiAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPT09ICdmaWxlOicpIHtcbiAgICAgICAgYWxlcnQoJ1RoZSBIVE1MNSBIaXN0b3J5IEFQSSAoYW5kIHRodXMgSGlzdG9yeS5qcykgZG8gbm90IHdvcmsgb24gZmlsZXMsIHBsZWFzZSB1cGxvYWQgaXQgdG8gYSBzZXJ2ZXIuJyk7XG4gICAgfVxuICAgIHByb2R1Y3RMaXN0LnVwZGF0ZUhpZGRlbklucHV0KGZ1bmN0aW9uKCkge1xuICAgICAgICBwcm9kdWN0TGlzdC5yZXN0b3JlUGFnZVN0YXR1cygpO1xuICAgIH0pO1xuICAgIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24oKSB7IC8vIE5vdGU6IFdlIGFyZSB1c2luZyBzdGF0ZWNoYW5nZSBpbnN0ZWFkIG9mIHBvcHN0YXRlXG4gICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTtcbiAgICAgICAgcHJvZHVjdExpc3QudXBkYXRlSGlkZGVuSW5wdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwcm9kdWN0TGlzdC5zZXR1cENsaWNrU3RhdHVzKCk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQWRhcHRlcicpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKHdpbmRvdyk7Il19
