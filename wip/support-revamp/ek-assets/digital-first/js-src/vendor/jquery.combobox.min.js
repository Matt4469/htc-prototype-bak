(function(a){a.widget("ui.combobox",{_create:function(){var e=this,b=this.element.hide(),g=b.children(":selected"),h=g.val()?g.text():"",c=/^[^a-zA-Z0-9]*([a-zA-Z0-9])/i,f=b.children("option").map(function(){if(this.value){var j=a(this).text(),i=e.options.label?e.options.label(this):j;return{label:i,value:j,option:this}}});var d=this.input=a("<input type='text' />").insertAfter(b).val(h).keydown(function(l){var m=a.ui.keyCode;switch(l.keyCode){case m.PAGE_UP:case m.PAGE_DOWN:case m.UP:case m.DOWN:case m.ENTER:case m.NUMPAD_ENTER:case m.TAB:case m.ESCAPE:break;default:l.stopImmediatePropagation();if((l.keyCode<91&&l.keyCode>59)||(l.keyCode<58&&l.keyCode>47)){var n=String.fromCharCode(l.keyCode).toLowerCase(),k=d.val(),i;var j=b.children().filter(function(){var p=c.exec(this.text);return(p&&p.length==2&&p[1].toLowerCase()==n)});if(!j.length){return false}if(k.length){var o=c.exec(k);if(o&&o.length==2&&o[1].toLowerCase()==n){j.each(function(p,q){if(q.selected){if((p+1)<=j.length-1){i=j[p+1]}return false}})}}if(!i){i=j[0]}i.selected=true;d.val(i.text);if(d.autocomplete("widget").is(":visible")){d.data("autocomplete").widget().children("li").each(function(){var p=a(this);if(p.data("item.autocomplete").option==i){d.data("autocomplete").menu.activate(l,p);return false}})}}return false;break}}).autocomplete({delay:0,minLength:0,source:function(j,i){i(f)},select:function(i,j){j.item.option.selected=true;e._trigger("selected",i,{item:j.item.option})},change:function(j,k){if(!k.item){var l=new RegExp("^"+a.ui.autocomplete.escapeRegex(a(this).val())+"$","i"),i=false;b.children("option").each(function(){if(a(this).text().match(l)){this.selected=i=true;return false}});if(!i){a(this).val("");b.val("");d.data("autocomplete").term="";return false}}}}).addClass("ui-widget ui-widget-content ui-corner-left").click(function(){e.button.click()}).bind("autocompleteopen",function(j,k){var i=b.children(":selected")[0];d.data("autocomplete").widget().children("li").each(function(){var l=a(this);if(l.data("item.autocomplete").option==i){d.data("autocomplete").menu.activate(j,l);return false}})});d.data("autocomplete")._renderItem=function(i,j){return a("<li></li>").data("item.autocomplete",j).append("<a href='#'>"+j.label+"</a>").appendTo(i)};d.css({width:function(){var i=g.parent();var k=i.clone();k.css({visibility:"hidden",width:"",height:"",maxWidth:"",maxHeight:""});a("body").append(k);var j=k.outerWidth();k.remove();return j+"px"}});this.button=a("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).attr("title","").insertAfter(d).button({icons:{primary:""},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").click(function(){if(d.autocomplete("widget").is(":visible")){d.autocomplete("close");return}d.autocomplete("search","");d.focus()})},setValue:function(b){var c=this.input;a("option",this.element).each(function(){if(a(this).val()==b){this.selected=true;c.val(this.text);return false}})},destroy:function(){this.input.remove();this.button.remove();this.element.show();a.Widget.prototype.destroy.call(this)},resetWidth:function(){var b;if(!a.browser.msie){b=this.input.width()+this.button.width()+29}else{if(parseInt(a.browser.version,10)==9){if(this.element.find("option").length>5){b=this.input.width()+25}else{b=this.input.width()+42}}else{if(this.element.find("option").length>5){b=this.input.width()+13}else{b=this.input.width()+30}}}if(b>0){this.input.autocomplete("widget").css("min-width",b+"px");this.input.autocomplete("widget").width(b)}},getValue:function(){return this.element.val()},getEngName:function(){return this.element.find("option:selected").data("engname").toString()}})})(jQuery);